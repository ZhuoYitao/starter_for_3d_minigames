{"version":3,"file":"nativeXRRenderTarget.js","sourceRoot":"","sources":["../../../../../../lts/core/generated/XR/native/nativeXRRenderTarget.ts"],"names":[],"mappings":";AAGA,OAAO,EAAE,iBAAiB,EAAE,MAAM,sBAAsB,CAAC;AACzD,OAAO,EAAE,qCAAqC,EAAE,MAAM,qCAAqC,CAAC;AAI5F;;;GAGG;AACH;IAA0C,wCAAiB;IACvD,8BAA4B,KAAmB;QAA/C,YACI,kBACI,cAAM,OAAA,KAAK,CAAC,gBAAgB,EAAtB,CAAsB,EAC5B,cAAM,OAAA,KAAK,CAAC,iBAAiB,EAAvB,CAAuB,EAC7B,KAAK,EACL,cAAc,EACd,UAAC,cAAc,IAAK,OAAA,IAAI,wCAAwC,CAAC,cAAc,EAAE,KAAI,CAAC,EAAlE,CAAkE,CACzF,SACJ;QAR2B,WAAK,GAAL,KAAK,CAAc;;IAQ/C,CAAC;IACL,2BAAC;AAAD,CAAC,AAVD,CAA0C,iBAAiB,GAU1D;;AAED;;;GAGG;AACH;IAA8D,4DAAqC;IAI/F,kDAAY,cAAmC,EAAkB,YAAkC;QAAnG,YACI,kBAAM,cAAc,CAAC,KAAK,EAAE,YAAY,CAAC,SAO5C;QARgE,kBAAY,GAAZ,YAAY,CAAsB;QAE/F,KAAI,CAAC,kBAAkB,GAAI,SAAiB,CAAC,EAAE,CAAC,6BAA6B,CACzE,cAAc,CAAC,OAAO,EACtB,KAAI,CAAC,0BAA0B,CAAC,IAAI,CAAC,KAAI,CAAC,EAC1C,KAAI,CAAC,2BAA2B,CAAC,IAAI,CAAC,KAAI,CAAC,CAC9C,CAAC;QACF,KAAI,CAAC,YAAY,GAAG,YAAY,CAAC,KAAK,CAAC;;IAC3C,CAAC;IAEM,wEAAqB,GAA5B,UAA6B,QAAkB;QAC3C,QAAQ,CAAC,CAAC,GAAG,CAAC,CAAC;QACf,QAAQ,CAAC,CAAC,GAAG,CAAC,CAAC;QACf,QAAQ,CAAC,KAAK,GAAG,CAAC,CAAC;QACnB,QAAQ,CAAC,MAAM,GAAG,CAAC,CAAC;QACpB,OAAO,IAAI,CAAC;IAChB,CAAC;IAEM,+EAA4B,GAAnC,UAAoC,GAAU;QAC1C,0GAA0G;QAC1G,OAAQ,IAAI,CAAC,kBAA0B,CAAC,qBAAqB,CAAC,GAAG,CAAC,CAAC;IACvE,CAAC;IAEM,gFAA6B,GAApC,UAAqC,IAAY;QAC7C,OAAQ,IAAI,CAAC,kBAA0B,CAAC,qBAAqB,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;IAC5E,CAAC;IAEM,2EAAwB,GAA/B;QACI,OAAO;YACH,gBAAgB,EAAE,IAAI,CAAC,YAAY,CAAC,gBAAgB;YACpD,iBAAiB,EAAE,IAAI,CAAC,YAAY,CAAC,iBAAiB;SACzD,CAAC;IACN,CAAC;IACL,+CAAC;AAAD,CAAC,AArCD,CAA8D,qCAAqC,GAqClG;;AAED;;;GAGG;AACH;IAMI,8BAAY,iBAAsC;QAC9C,IAAI,CAAC,mBAAmB,GAAI,SAAiB,CAAC,EAAE,CAAC,oBAAoB,CAAC,iBAAiB,CAAC,KAAK,CAAC,SAAS,EAAE,CAAC,CAAC;IAC/G,CAAC;IAEY,qDAAsB,GAAnC,UAAoC,SAAoB;;;;4BACpD,qBAAM,IAAI,CAAC,mBAAmB,CAAC,sBAAsB,CAAC,SAAS,CAAC,EAAA;;wBAAhE,SAAgE,CAAC;wBACjE,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC,mBAAmB,CAAC,OAAQ,CAAC;wBACjD,sBAAO,IAAI,CAAC,OAAO,EAAC;;;;KACvB;IAED,sCAAO,GAAP;QACI,WAAW;IACf,CAAC;IACL,2BAAC;AAAD,CAAC,AAnBD,IAmBC","sourcesContent":["import type { RenderTargetTexture } from \"../../Materials/Textures/renderTargetTexture\";\r\nimport type { Viewport } from \"../../Maths/math.viewport\";\r\nimport type { Nullable } from \"../../types\";\r\nimport { WebXRLayerWrapper } from \"../webXRLayerWrapper\";\r\nimport { WebXRLayerRenderTargetTextureProvider } from \"../webXRRenderTargetTextureProvider\";\r\nimport type { WebXRSessionManager } from \"../webXRSessionManager\";\r\nimport type { WebXRRenderTarget } from \"../webXRTypes\";\r\n\r\n/**\r\n * Wraps XRWebGLLayer's created by Babylon Native.\r\n * @hidden\r\n */\r\nexport class NativeXRLayerWrapper extends WebXRLayerWrapper {\r\n    constructor(public readonly layer: XRWebGLLayer) {\r\n        super(\r\n            () => layer.framebufferWidth,\r\n            () => layer.framebufferHeight,\r\n            layer,\r\n            \"XRWebGLLayer\",\r\n            (sessionManager) => new NativeXRLayerRenderTargetTextureProvider(sessionManager, this)\r\n        );\r\n    }\r\n}\r\n\r\n/**\r\n * Provides render target textures for layers created by Babylon Native.\r\n * @hidden\r\n */\r\nexport class NativeXRLayerRenderTargetTextureProvider extends WebXRLayerRenderTargetTextureProvider {\r\n    private _nativeRTTProvider: WebXRLayerRenderTargetTextureProvider;\r\n    private _nativeLayer: XRWebGLLayer;\r\n\r\n    constructor(sessionManager: WebXRSessionManager, public readonly layerWrapper: NativeXRLayerWrapper) {\r\n        super(sessionManager.scene, layerWrapper);\r\n        this._nativeRTTProvider = (navigator as any).xr.getNativeRenderTargetProvider(\r\n            sessionManager.session,\r\n            this._createRenderTargetTexture.bind(this),\r\n            this._destroyRenderTargetTexture.bind(this)\r\n        );\r\n        this._nativeLayer = layerWrapper.layer;\r\n    }\r\n\r\n    public trySetViewportForView(viewport: Viewport): boolean {\r\n        viewport.x = 0;\r\n        viewport.y = 0;\r\n        viewport.width = 1;\r\n        viewport.height = 1;\r\n        return true;\r\n    }\r\n\r\n    public getRenderTargetTextureForEye(eye: XREye): Nullable<RenderTargetTexture> {\r\n        // TODO (rgerd): Update the contract on the BabylonNative side to call this \"getRenderTargetTextureForEye\"\r\n        return (this._nativeRTTProvider as any).getRenderTargetForEye(eye);\r\n    }\r\n\r\n    public getRenderTargetTextureForView(view: XRView): Nullable<RenderTargetTexture> {\r\n        return (this._nativeRTTProvider as any).getRenderTargetForEye(view.eye);\r\n    }\r\n\r\n    public getFramebufferDimensions(): Nullable<{ framebufferWidth: number; framebufferHeight: number }> {\r\n        return {\r\n            framebufferWidth: this._nativeLayer.framebufferWidth,\r\n            framebufferHeight: this._nativeLayer.framebufferHeight,\r\n        };\r\n    }\r\n}\r\n\r\n/**\r\n * Creates the xr layer that will be used as the xr session's base layer.\r\n * @hidden\r\n */\r\nexport class NativeXRRenderTarget implements WebXRRenderTarget {\r\n    public canvasContext: WebGLRenderingContext;\r\n    public xrLayer: Nullable<XRWebGLLayer>;\r\n\r\n    private _nativeRenderTarget: WebXRRenderTarget;\r\n\r\n    constructor(_xrSessionManager: WebXRSessionManager) {\r\n        this._nativeRenderTarget = (navigator as any).xr.getWebXRRenderTarget(_xrSessionManager.scene.getEngine());\r\n    }\r\n\r\n    public async initializeXRLayerAsync(xrSession: XRSession): Promise<XRWebGLLayer> {\r\n        await this._nativeRenderTarget.initializeXRLayerAsync(xrSession);\r\n        this.xrLayer = this._nativeRenderTarget.xrLayer!;\r\n        return this.xrLayer;\r\n    }\r\n\r\n    dispose(): void {\r\n        /* empty */\r\n    }\r\n}\r\n"]}