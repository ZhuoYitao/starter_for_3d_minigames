{"version":3,"file":"webgpuEngine.js","sourceRoot":"","sources":["../../../../../lts/core/generated/Engines/webgpuEngine.ts"],"names":[],"mappings":"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","sourcesContent":["import { Logger } from \"../Misc/logger\";\r\nimport { IsWindowObjectExist } from \"../Misc/domManagement\";\r\nimport type { Nullable, DataArray, IndicesArray, Immutable } from \"../types\";\r\nimport { Color4 } from \"../Maths/math\";\r\nimport { Engine } from \"../Engines/engine\";\r\nimport { InternalTexture, InternalTextureSource } from \"../Materials/Textures/internalTexture\";\r\nimport type { IEffectCreationOptions } from \"../Materials/effect\";\r\nimport { Effect } from \"../Materials/effect\";\r\nimport type { EffectFallbacks } from \"../Materials/effectFallbacks\";\r\nimport { Constants } from \"./constants\";\r\nimport * as WebGPUConstants from \"./WebGPU/webgpuConstants\";\r\nimport { VertexBuffer } from \"../Buffers/buffer\";\r\nimport type { IWebGPURenderPipelineStageDescriptor } from \"./WebGPU/webgpuPipelineContext\";\r\nimport { WebGPUPipelineContext } from \"./WebGPU/webgpuPipelineContext\";\r\nimport type { IPipelineContext } from \"./IPipelineContext\";\r\nimport type { DataBuffer } from \"../Buffers/dataBuffer\";\r\nimport type { BaseTexture } from \"../Materials/Textures/baseTexture\";\r\nimport type { IShaderProcessor } from \"./Processors/iShaderProcessor\";\r\nimport { WebGPUShaderProcessorGLSL } from \"./WebGPU/webgpuShaderProcessorsGLSL\";\r\nimport { WebGPUShaderProcessorWGSL } from \"./WebGPU/webgpuShaderProcessorsWGSL\";\r\nimport type { ShaderProcessingContext } from \"./Processors/shaderProcessingOptions\";\r\nimport { WebGPUShaderProcessingContext } from \"./WebGPU/webgpuShaderProcessingContext\";\r\nimport { Tools } from \"../Misc/tools\";\r\nimport { WebGPUTextureHelper } from \"./WebGPU/webgpuTextureHelper\";\r\nimport type { ISceneLike } from \"./thinEngine\";\r\nimport { WebGPUBufferManager } from \"./WebGPU/webgpuBufferManager\";\r\nimport type { HardwareTextureWrapper } from \"../Materials/Textures/hardwareTextureWrapper\";\r\nimport { WebGPUHardwareTexture } from \"./WebGPU/webgpuHardwareTexture\";\r\nimport type { IColor4Like } from \"../Maths/math.like\";\r\nimport { UniformBuffer } from \"../Materials/uniformBuffer\";\r\nimport { WebGPURenderPassWrapper } from \"./WebGPU/webgpuRenderPassWrapper\";\r\nimport { WebGPUCacheSampler } from \"./WebGPU/webgpuCacheSampler\";\r\nimport type { WebGPUCacheRenderPipeline } from \"./WebGPU/webgpuCacheRenderPipeline\";\r\nimport { WebGPUCacheRenderPipelineTree } from \"./WebGPU/webgpuCacheRenderPipelineTree\";\r\nimport { WebGPUStencilStateComposer } from \"./WebGPU/webgpuStencilStateComposer\";\r\nimport { WebGPUDepthCullingState } from \"./WebGPU/webgpuDepthCullingState\";\r\nimport { DrawWrapper } from \"../Materials/drawWrapper\";\r\nimport { WebGPUMaterialContext } from \"./WebGPU/webgpuMaterialContext\";\r\nimport { WebGPUDrawContext } from \"./WebGPU/webgpuDrawContext\";\r\nimport { WebGPUCacheBindGroups } from \"./WebGPU/webgpuCacheBindGroups\";\r\nimport { WebGPUClearQuad } from \"./WebGPU/webgpuClearQuad\";\r\nimport type { IStencilState } from \"../States/IStencilState\";\r\nimport { WebGPURenderItemBlendColor, WebGPURenderItemScissor, WebGPURenderItemStencilRef, WebGPURenderItemViewport, WebGPUBundleList } from \"./WebGPU/webgpuBundleList\";\r\nimport { WebGPUTimestampQuery } from \"./WebGPU/webgpuTimestampQuery\";\r\nimport type { ComputeEffect } from \"../Compute/computeEffect\";\r\nimport { WebGPUOcclusionQuery } from \"./WebGPU/webgpuOcclusionQuery\";\r\nimport { Observable } from \"../Misc/observable\";\r\nimport { ShaderCodeInliner } from \"./Processors/shaderCodeInliner\";\r\nimport type { TwgslOptions } from \"./WebGPU/webgpuTintWASM\";\r\nimport { WebGPUTintWASM } from \"./WebGPU/webgpuTintWASM\";\r\nimport type { ExternalTexture } from \"../Materials/Textures/externalTexture\";\r\nimport { WebGPUShaderProcessor } from \"./WebGPU/webgpuShaderProcessor\";\r\nimport { ShaderLanguage } from \"../Materials/shaderLanguage\";\r\nimport type { InternalTextureCreationOptions, TextureSize } from \"../Materials/Textures/textureCreationOptions\";\r\nimport { WebGPUSnapshotRendering } from \"./WebGPU/webgpuSnapshotRendering\";\r\nimport type { WebGPUDataBuffer } from \"../Meshes/WebGPU/webgpuDataBuffer\";\r\nimport type { WebGPURenderTargetWrapper } from \"./WebGPU/webgpuRenderTargetWrapper\";\r\nimport { PerformanceConfigurator } from \"./performanceConfigurator\";\r\n\r\ndeclare function importScripts(...urls: string[]): void;\r\n\r\ndeclare type VideoTexture = import(\"../Materials/Textures/videoTexture\").VideoTexture;\r\ndeclare type RenderTargetTexture = import(\"../Materials/Textures/renderTargetTexture\").RenderTargetTexture;\r\ndeclare type RenderTargetWrapper = import(\"./renderTargetWrapper\").RenderTargetWrapper;\r\n\r\n/**\r\n * Options to load the associated Glslang library\r\n */\r\nexport interface GlslangOptions {\r\n    /**\r\n     * Defines an existing instance of Glslang (useful in modules who do not access the global instance).\r\n     */\r\n    glslang?: any;\r\n    /**\r\n     * Defines the URL of the glslang JS File.\r\n     */\r\n    jsPath?: string;\r\n    /**\r\n     * Defines the URL of the glslang WASM File.\r\n     */\r\n    wasmPath?: string;\r\n}\r\n\r\n/**\r\n * Options to create the WebGPU engine\r\n */\r\nexport interface WebGPUEngineOptions extends GPURequestAdapterOptions {\r\n    /**\r\n     * If delta time between frames should be constant\r\n     * @see https://doc.babylonjs.com/babylon101/animations#deterministic-lockstep\r\n     */\r\n    deterministicLockstep?: boolean;\r\n\r\n    /**\r\n     * Maximum about of steps between frames (Default: 4)\r\n     * @see https://doc.babylonjs.com/babylon101/animations#deterministic-lockstep\r\n     */\r\n    lockstepMaxSteps?: number;\r\n\r\n    /**\r\n     * Defines the seconds between each deterministic lock step\r\n     */\r\n    timeStep?: number;\r\n\r\n    /**\r\n     * Defines that engine should ignore context lost events\r\n     * If this event happens when this parameter is true, you will have to reload the page to restore rendering\r\n     */\r\n    doNotHandleContextLost?: boolean;\r\n\r\n    /**\r\n     * Defines that engine should ignore modifying touch action attribute and style\r\n     * If not handle, you might need to set it up on your side for expected touch devices behavior.\r\n     */\r\n    doNotHandleTouchAction?: boolean;\r\n\r\n    /**\r\n     * Defines if webaudio should be initialized as well\r\n     * @see http://doc.babylonjs.com/how_to/playing_sounds_and_music\r\n     */\r\n    audioEngine?: boolean;\r\n\r\n    /**\r\n     * Defines the category of adapter to use.\r\n     * Is it the discrete or integrated device.\r\n     */\r\n    powerPreference?: GPUPowerPreference;\r\n\r\n    /**\r\n     * Defines the device descriptor used to create a device.\r\n     */\r\n    deviceDescriptor?: GPUDeviceDescriptor;\r\n\r\n    /**\r\n     * Defines the requested Swap Chain Format.\r\n     */\r\n    swapChainFormat?: GPUTextureFormat;\r\n\r\n    /**\r\n     * Defines whether MSAA is enabled on the canvas.\r\n     */\r\n    antialiasing?: boolean;\r\n\r\n    /**\r\n     * Defines whether the stencil buffer should be enabled.\r\n     */\r\n    stencil?: boolean;\r\n\r\n    /**\r\n     * Defines whether we should generate debug markers in the gpu command lists (can be seen with PIX for eg)\r\n     */\r\n    enableGPUDebugMarkers?: boolean;\r\n\r\n    /**\r\n     * Options to load the associated Glslang library\r\n     */\r\n    glslangOptions?: GlslangOptions;\r\n\r\n    /**\r\n     * Options to load the associated Twgsl library\r\n     */\r\n    twgslOptions?: TwgslOptions;\r\n\r\n    /**\r\n     * Defines if the engine should no exceed a specified device ratio\r\n     * @see https://developer.mozilla.org/en-US/docs/Web/API/Window/devicePixelRatio\r\n     */\r\n    limitDeviceRatio?: number;\r\n\r\n    /**\r\n     * Defines whether to adapt to the device's viewport characteristics (default: false)\r\n     */\r\n    adaptToDeviceRatio?: boolean;\r\n\r\n    /**\r\n     * Defines whether the canvas should be created in \"premultiplied\" mode (if false, the canvas is created in the \"opaque\" mode) (true by default)\r\n     */\r\n    premultipliedAlpha?: boolean;\r\n\r\n    /**\r\n     * Make the matrix computations to be performed in 64 bits instead of 32 bits. False by default\r\n     */\r\n    useHighPrecisionMatrix?: boolean;\r\n}\r\n\r\n/**\r\n * The web GPU engine class provides support for WebGPU version of babylon.js.\r\n * @since 5.0.0\r\n */\r\nexport class WebGPUEngine extends Engine {\r\n    // Default glslang options.\r\n    private static readonly _GLSLslangDefaultOptions: GlslangOptions = {\r\n        jsPath: \"https://preview.babylonjs.com/glslang/glslang.js\",\r\n        wasmPath: \"https://preview.babylonjs.com/glslang/glslang.wasm\",\r\n    };\r\n\r\n    /** true to enable using TintWASM to convert Spir-V to WGSL */\r\n    public static UseTWGSL = true;\r\n\r\n    // Page Life cycle and constants\r\n    private readonly _uploadEncoderDescriptor = { label: \"upload\" };\r\n    private readonly _renderEncoderDescriptor = { label: \"render\" };\r\n    private readonly _renderTargetEncoderDescriptor = { label: \"renderTarget\" };\r\n    /** @hidden */\r\n    public readonly _clearDepthValue = 1;\r\n    /** @hidden */\r\n    public readonly _clearReverseDepthValue = 0;\r\n    /** @hidden */\r\n    public readonly _clearStencilValue = 0;\r\n    private readonly _defaultSampleCount = 4; // Only supported value for now.\r\n\r\n    // Engine Life Cycle\r\n    private _canvas: HTMLCanvasElement;\r\n    /** @hidden */\r\n    public _options: WebGPUEngineOptions;\r\n    private _glslang: any = null;\r\n    private _tintWASM: Nullable<WebGPUTintWASM> = null;\r\n    private _adapter: GPUAdapter;\r\n    private _adapterSupportedExtensions: GPUFeatureName[];\r\n    /** @hidden */\r\n    public _device: GPUDevice;\r\n    private _deviceEnabledExtensions: GPUFeatureName[];\r\n    private _context: GPUCanvasContext;\r\n    private _swapChainTexture: GPUTexture;\r\n    private _mainPassSampleCount: number;\r\n    /** @hidden */\r\n    public _textureHelper: WebGPUTextureHelper;\r\n    /** @hidden */\r\n    public _bufferManager: WebGPUBufferManager;\r\n    private _clearQuad: WebGPUClearQuad;\r\n    /** @hidden */\r\n    public _cacheSampler: WebGPUCacheSampler;\r\n    /** @hidden */\r\n    public _cacheRenderPipeline: WebGPUCacheRenderPipeline;\r\n    private _cacheBindGroups: WebGPUCacheBindGroups;\r\n    private _emptyVertexBuffer: VertexBuffer;\r\n    /** @hidden */\r\n    public _mrtAttachments: number[];\r\n    /** @hidden */\r\n    public _timestampQuery: WebGPUTimestampQuery;\r\n    /** @hidden */\r\n    public _occlusionQuery: WebGPUOcclusionQuery;\r\n    /** @hidden */\r\n    public _compiledComputeEffects: { [key: string]: ComputeEffect } = {};\r\n    /** @hidden */\r\n    public _counters: {\r\n        numEnableEffects: number;\r\n        numEnableDrawWrapper: number;\r\n        numBundleCreationNonCompatMode: number;\r\n        numBundleReuseNonCompatMode: number;\r\n    } = {\r\n        numEnableEffects: 0,\r\n        numEnableDrawWrapper: 0,\r\n        numBundleCreationNonCompatMode: 0,\r\n        numBundleReuseNonCompatMode: 0,\r\n    };\r\n    /**\r\n     * Counters from last frame\r\n     */\r\n    public readonly countersLastFrame: {\r\n        numEnableEffects: number;\r\n        numEnableDrawWrapper: number;\r\n        numBundleCreationNonCompatMode: number;\r\n        numBundleReuseNonCompatMode: number;\r\n    } = {\r\n        numEnableEffects: 0,\r\n        numEnableDrawWrapper: 0,\r\n        numBundleCreationNonCompatMode: 0,\r\n        numBundleReuseNonCompatMode: 0,\r\n    };\r\n    /**\r\n     * Max number of uncaptured error messages to log\r\n     */\r\n    public numMaxUncapturedErrors = 20;\r\n\r\n    // Some of the internal state might change during the render pass.\r\n    // This happens mainly during clear for the state\r\n    // And when the frame starts to swap the target texture from the swap chain\r\n    private _mainTexture: GPUTexture;\r\n    private _mainTextureLastCopy: GPUTexture;\r\n    private _depthTexture: GPUTexture;\r\n    private _mainTextureExtends: GPUExtent3D;\r\n    private _depthTextureFormat: GPUTextureFormat | undefined;\r\n    private _colorFormat: GPUTextureFormat | null;\r\n    /** @hidden */\r\n    public _ubInvertY: WebGPUDataBuffer;\r\n    /** @hidden */\r\n    public _ubDontInvertY: WebGPUDataBuffer;\r\n\r\n    // Frame Life Cycle (recreated each frame)\r\n    /** @hidden */\r\n    public _uploadEncoder: GPUCommandEncoder;\r\n    /** @hidden */\r\n    public _renderEncoder: GPUCommandEncoder;\r\n    /** @hidden */\r\n    public _renderTargetEncoder: GPUCommandEncoder;\r\n\r\n    private _commandBuffers: GPUCommandBuffer[] = [null as any, null as any, null as any];\r\n\r\n    // Frame Buffer Life Cycle (recreated for each render target pass)\r\n    /** @hidden */\r\n    public _currentRenderPass: Nullable<GPURenderPassEncoder> = null;\r\n    /** @hidden */\r\n    public _mainRenderPassWrapper: WebGPURenderPassWrapper = new WebGPURenderPassWrapper();\r\n    /** @hidden */\r\n    public _rttRenderPassWrapper: WebGPURenderPassWrapper = new WebGPURenderPassWrapper();\r\n    /** @hidden */\r\n    public _pendingDebugCommands: Array<[string, Nullable<string>]> = [];\r\n    /** @hidden */\r\n    public _bundleList: WebGPUBundleList;\r\n    /** @hidden */\r\n    public _bundleListRenderTarget: WebGPUBundleList;\r\n    /** @hidden */\r\n    public _onAfterUnbindFrameBufferObservable = new Observable<WebGPUEngine>();\r\n\r\n    // DrawCall Life Cycle\r\n    // Effect is on the parent class\r\n    // protected _currentEffect: Nullable<Effect> = null;\r\n    private _defaultDrawContext: WebGPUDrawContext;\r\n    private _defaultMaterialContext: WebGPUMaterialContext;\r\n    /** @hidden */\r\n    public _currentDrawContext: WebGPUDrawContext;\r\n    /** @hidden */\r\n    public _currentMaterialContext: WebGPUMaterialContext;\r\n    private _currentOverrideVertexBuffers: Nullable<{ [key: string]: Nullable<VertexBuffer> }> = null;\r\n    private _currentIndexBuffer: Nullable<DataBuffer> = null;\r\n    private _colorWriteLocal = true;\r\n    private _forceEnableEffect = false;\r\n\r\n    // TODO WEBGPU remove those variables when code stabilized\r\n    /** @hidden */\r\n    public dbgShowShaderCode = false;\r\n    /** @hidden */\r\n    public dbgSanityChecks = true;\r\n    /** @hidden */\r\n    public dbgVerboseLogsForFirstFrames = false;\r\n    /** @hidden */\r\n    public dbgVerboseLogsNumFrames = 10;\r\n    /** @hidden */\r\n    public dbgLogIfNotDrawWrapper = true;\r\n    /** @hidden */\r\n    public dbgShowEmptyEnableEffectCalls = true;\r\n\r\n    private _snapshotRendering: WebGPUSnapshotRendering;\r\n\r\n    /**\r\n     * Gets or sets the snapshot rendering mode\r\n     */\r\n    public get snapshotRenderingMode(): number {\r\n        return this._snapshotRendering.mode;\r\n    }\r\n\r\n    public set snapshotRenderingMode(mode: number) {\r\n        this._snapshotRendering.mode = mode;\r\n    }\r\n\r\n    /**\r\n     * Creates a new snapshot at the next frame using the current snapshotRenderingMode\r\n     */\r\n    public snapshotRenderingReset(): void {\r\n        this._snapshotRendering.reset();\r\n    }\r\n\r\n    /**\r\n     * Enables or disables the snapshot rendering mode\r\n     * Note that the WebGL engine does not support snapshot rendering so setting the value won't have any effect for this engine\r\n     */\r\n    public get snapshotRendering(): boolean {\r\n        return this._snapshotRendering.enabled;\r\n    }\r\n\r\n    public set snapshotRendering(activate) {\r\n        this._snapshotRendering.enabled = activate;\r\n    }\r\n\r\n    /**\r\n     * Sets this to true to disable the cache for the samplers. You should do it only for testing purpose!\r\n     */\r\n    public get disableCacheSamplers(): boolean {\r\n        return this._cacheSampler ? this._cacheSampler.disabled : false;\r\n    }\r\n\r\n    public set disableCacheSamplers(disable: boolean) {\r\n        if (this._cacheSampler) {\r\n            this._cacheSampler.disabled = disable;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Sets this to true to disable the cache for the render pipelines. You should do it only for testing purpose!\r\n     */\r\n    public get disableCacheRenderPipelines(): boolean {\r\n        return this._cacheRenderPipeline ? this._cacheRenderPipeline.disabled : false;\r\n    }\r\n\r\n    public set disableCacheRenderPipelines(disable: boolean) {\r\n        if (this._cacheRenderPipeline) {\r\n            this._cacheRenderPipeline.disabled = disable;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Sets this to true to disable the cache for the bind groups. You should do it only for testing purpose!\r\n     */\r\n    public get disableCacheBindGroups(): boolean {\r\n        return this._cacheBindGroups ? this._cacheBindGroups.disabled : false;\r\n    }\r\n\r\n    public set disableCacheBindGroups(disable: boolean) {\r\n        if (this._cacheBindGroups) {\r\n            this._cacheBindGroups.disabled = disable;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Gets a Promise<boolean> indicating if the engine can be instantiated (ie. if a WebGPU context can be found)\r\n     */\r\n    public static get IsSupportedAsync(): Promise<boolean> {\r\n        return !navigator.gpu\r\n            ? Promise.resolve(false)\r\n            : navigator.gpu\r\n                  .requestAdapter()\r\n                  .then(\r\n                      (adapter: GPUAdapter | null) => !!adapter,\r\n                      () => false\r\n                  )\r\n                  .catch(() => false);\r\n    }\r\n\r\n    /**\r\n     * Not supported by WebGPU, you should call IsSupportedAsync instead!\r\n     */\r\n    public static get IsSupported(): boolean {\r\n        Logger.Warn(\"You must call IsSupportedAsync for WebGPU!\");\r\n        return false;\r\n    }\r\n\r\n    /**\r\n     * Gets a boolean indicating that the engine supports uniform buffers\r\n     */\r\n    public get supportsUniformBuffers(): boolean {\r\n        return true;\r\n    }\r\n\r\n    /** Gets the supported extensions by the WebGPU adapter */\r\n    public get supportedExtensions(): Immutable<GPUFeatureName[]> {\r\n        return this._adapterSupportedExtensions;\r\n    }\r\n\r\n    /** Gets the currently enabled extensions on the WebGPU device */\r\n    public get enabledExtensions(): Immutable<GPUFeatureName[]> {\r\n        return this._deviceEnabledExtensions;\r\n    }\r\n\r\n    /**\r\n     * Returns a string describing the current engine\r\n     */\r\n    public get description(): string {\r\n        const description = this.name + this.version;\r\n\r\n        return description;\r\n    }\r\n\r\n    /**\r\n     * Returns the version of the engine\r\n     */\r\n    public get version(): number {\r\n        return 1;\r\n    }\r\n\r\n    /**\r\n     * Gets an object containing information about the current engine context\r\n     * @returns an object containing the vendor, the renderer and the version of the current engine context\r\n     */\r\n    public getInfo() {\r\n        return {\r\n            vendor: \"unknown vendor\",\r\n            renderer: \"unknown renderer\",\r\n            version: \"unknown version\",\r\n        };\r\n    }\r\n\r\n    /**\r\n     * (WebGPU only) True (default) to be in compatibility mode, meaning rendering all existing scenes without artifacts (same rendering than WebGL).\r\n     * Setting the property to false will improve performances but may not work in some scenes if some precautions are not taken.\r\n     * See https://doc.babylonjs.com/advanced_topics/webGPU/webGPUOptimization/webGPUNonCompatibilityMode for more details\r\n     */\r\n    public get compatibilityMode() {\r\n        return this._compatibilityMode;\r\n    }\r\n\r\n    public set compatibilityMode(mode: boolean) {\r\n        this._compatibilityMode = mode;\r\n    }\r\n\r\n    /** @hidden */\r\n    public get currentSampleCount(): number {\r\n        return this._currentRenderTarget ? this._currentRenderTarget.samples : this._mainPassSampleCount;\r\n    }\r\n\r\n    /**\r\n     * Create a new instance of the gpu engine asynchronously\r\n     * @param canvas Defines the canvas to use to display the result\r\n     * @param options Defines the options passed to the engine to create the GPU context dependencies\r\n     * @returns a promise that resolves with the created engine\r\n     */\r\n    public static CreateAsync(canvas: HTMLCanvasElement, options: WebGPUEngineOptions = {}): Promise<WebGPUEngine> {\r\n        const engine = new WebGPUEngine(canvas, options);\r\n\r\n        return new Promise((resolve) => {\r\n            engine.initAsync(options.glslangOptions, options.twgslOptions).then(() => resolve(engine));\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Create a new instance of the gpu engine.\r\n     * @param canvas Defines the canvas to use to display the result\r\n     * @param options Defines the options passed to the engine to create the GPU context dependencies\r\n     */\r\n    public constructor(canvas: HTMLCanvasElement, options: WebGPUEngineOptions = {}) {\r\n        super(null);\r\n        this._name = \"WebGPU\";\r\n\r\n        (this.isNDCHalfZRange as any) = true;\r\n        (this.hasOriginBottomLeft as any) = false;\r\n\r\n        options.deviceDescriptor = options.deviceDescriptor || {};\r\n        options.swapChainFormat = options.swapChainFormat || WebGPUConstants.TextureFormat.BGRA8Unorm;\r\n        options.antialiasing = options.antialiasing === undefined ? true : options.antialiasing;\r\n        options.stencil = options.stencil ?? true;\r\n        options.enableGPUDebugMarkers = options.enableGPUDebugMarkers ?? false;\r\n\r\n        PerformanceConfigurator.SetMatrixPrecision(!!options.useHighPrecisionMatrix);\r\n\r\n        Logger.Log(`Babylon.js v${Engine.Version} - ${this.description} engine`);\r\n        if (!navigator.gpu) {\r\n            Logger.Error(\"WebGPU is not supported by your browser.\");\r\n            return;\r\n        }\r\n\r\n        this._isWebGPU = true;\r\n        this._shaderPlatformName = \"WEBGPU\";\r\n\r\n        if (options.deterministicLockstep === undefined) {\r\n            options.deterministicLockstep = false;\r\n        }\r\n\r\n        if (options.lockstepMaxSteps === undefined) {\r\n            options.lockstepMaxSteps = 4;\r\n        }\r\n\r\n        if (options.audioEngine === undefined) {\r\n            options.audioEngine = true;\r\n        }\r\n\r\n        this._deterministicLockstep = options.deterministicLockstep;\r\n        this._lockstepMaxSteps = options.lockstepMaxSteps;\r\n        this._timeStep = options.timeStep || 1 / 60;\r\n\r\n        this._doNotHandleContextLost = !!options.doNotHandleContextLost;\r\n\r\n        this._canvas = canvas;\r\n        this._options = options;\r\n        this.premultipliedAlpha = options.premultipliedAlpha ?? true;\r\n\r\n        const devicePixelRatio = IsWindowObjectExist() ? window.devicePixelRatio || 1.0 : 1.0;\r\n        const limitDeviceRatio = options.limitDeviceRatio || devicePixelRatio;\r\n        const adaptToDeviceRatio = options.adaptToDeviceRatio ?? false;\r\n\r\n        this._hardwareScalingLevel = adaptToDeviceRatio ? 1.0 / Math.min(limitDeviceRatio, devicePixelRatio) : 1.0;\r\n        this._mainPassSampleCount = options.antialiasing ? this._defaultSampleCount : 1;\r\n        this._isStencilEnable = options.stencil;\r\n\r\n        this._sharedInit(canvas, !!options.doNotHandleTouchAction, options.audioEngine);\r\n\r\n        this._shaderProcessor = new WebGPUShaderProcessorGLSL();\r\n        this._shaderProcessorWGSL = new WebGPUShaderProcessorWGSL();\r\n    }\r\n\r\n    //------------------------------------------------------------------------------\r\n    //                              Initialization\r\n    //------------------------------------------------------------------------------\r\n\r\n    /**\r\n     * Initializes the WebGPU context and dependencies.\r\n     * @param glslangOptions Defines the GLSLang compiler options if necessary\r\n     * @param twgslOptions Defines the Twgsl compiler options if necessary\r\n     * @returns a promise notifying the readiness of the engine.\r\n     */\r\n    public initAsync(glslangOptions?: GlslangOptions, twgslOptions?: TwgslOptions): Promise<void> {\r\n        return this._initGlslang(glslangOptions ?? this._options?.glslangOptions)\r\n            .then(\r\n                (glslang: any) => {\r\n                    this._glslang = glslang;\r\n                    this._tintWASM = WebGPUEngine.UseTWGSL ? new WebGPUTintWASM() : null;\r\n                    return this._tintWASM\r\n                        ? this._tintWASM.initTwgsl(twgslOptions ?? this._options?.twgslOptions).then(\r\n                              () => {\r\n                                  return navigator.gpu!.requestAdapter(this._options);\r\n                              },\r\n                              (msg: string) => {\r\n                                  Logger.Error(\"Can not initialize twgsl!\");\r\n                                  Logger.Error(msg);\r\n                                  throw Error(\"WebGPU initializations stopped.\");\r\n                              }\r\n                          )\r\n                        : navigator.gpu!.requestAdapter(this._options);\r\n                },\r\n                (msg: string) => {\r\n                    Logger.Error(\"Can not initialize glslang!\");\r\n                    Logger.Error(msg);\r\n                    throw Error(\"WebGPU initializations stopped.\");\r\n                }\r\n            )\r\n            .then((adapter: GPUAdapter | null) => {\r\n                if (!adapter) {\r\n                    throw \"Could not retrieve a WebGPU adapter (adapter is null).\";\r\n                } else {\r\n                    this._adapter = adapter!;\r\n                    this._adapterSupportedExtensions = [];\r\n                    this._adapter.features?.forEach((feature) => this._adapterSupportedExtensions.push(feature as WebGPUConstants.FeatureName));\r\n\r\n                    const deviceDescriptor = this._options.deviceDescriptor;\r\n\r\n                    if (deviceDescriptor?.requiredFeatures) {\r\n                        const requestedExtensions = deviceDescriptor.requiredFeatures;\r\n                        const validExtensions: GPUFeatureName[] = [];\r\n\r\n                        for (const extension of requestedExtensions) {\r\n                            if (this._adapterSupportedExtensions.indexOf(extension) !== -1) {\r\n                                validExtensions.push(extension);\r\n                            }\r\n                        }\r\n\r\n                        deviceDescriptor.requiredFeatures = validExtensions;\r\n                    }\r\n\r\n                    return this._adapter.requestDevice(this._options.deviceDescriptor);\r\n                }\r\n            })\r\n            .then(\r\n                (device: GPUDevice) => {\r\n                    this._device = device;\r\n                    this._deviceEnabledExtensions = [];\r\n                    this._device.features?.forEach((feature) => this._deviceEnabledExtensions.push(feature as WebGPUConstants.FeatureName));\r\n\r\n                    let numUncapturedErrors = -1;\r\n                    this._device.addEventListener(\"uncapturederror\", (event) => {\r\n                        if (++numUncapturedErrors < this.numMaxUncapturedErrors) {\r\n                            Logger.Warn(`WebGPU uncaptured error (${numUncapturedErrors + 1}): ${(<GPUUncapturedErrorEvent>event).error} - ${(<any>event).error.message}`);\r\n                        } else if (numUncapturedErrors++ === this.numMaxUncapturedErrors) {\r\n                            Logger.Warn(\r\n                                `WebGPU uncaptured error: too many warnings (${this.numMaxUncapturedErrors}), no more warnings will be reported to the console for this engine.`\r\n                            );\r\n                        }\r\n                    });\r\n\r\n                    if (!this._doNotHandleContextLost) {\r\n                        this._device.lost?.then((info) => {\r\n                            this._contextWasLost = true;\r\n                            Logger.Warn(\"WebGPU context lost. \" + info);\r\n                            this.onContextLostObservable.notifyObservers(this);\r\n                            this._restoreEngineAfterContextLost(this.initAsync.bind(this));\r\n                        });\r\n                    }\r\n                },\r\n                (e: any) => {\r\n                    Logger.Error(\"Could not retrieve a WebGPU device.\");\r\n                    Logger.Error(e);\r\n                }\r\n            )\r\n            .then(() => {\r\n                this._bufferManager = new WebGPUBufferManager(this._device);\r\n                this._textureHelper = new WebGPUTextureHelper(this._device, this._glslang, this._tintWASM, this._bufferManager);\r\n                this._cacheSampler = new WebGPUCacheSampler(this._device);\r\n                this._cacheBindGroups = new WebGPUCacheBindGroups(this._device, this._cacheSampler, this);\r\n                this._timestampQuery = new WebGPUTimestampQuery(this._device, this._bufferManager);\r\n                this._occlusionQuery = (this._device as any).createQuerySet ? new WebGPUOcclusionQuery(this, this._device, this._bufferManager) : (undefined as any);\r\n                this._bundleList = new WebGPUBundleList(this._device);\r\n                this._bundleListRenderTarget = new WebGPUBundleList(this._device);\r\n                this._snapshotRendering = new WebGPUSnapshotRendering(this, this._snapshotRenderingMode, this._bundleList, this._bundleListRenderTarget);\r\n\r\n                this._ubInvertY = this._bufferManager.createBuffer(new Float32Array([-1, 0]), WebGPUConstants.BufferUsage.Uniform | WebGPUConstants.BufferUsage.CopyDst);\r\n                this._ubDontInvertY = this._bufferManager.createBuffer(new Float32Array([1, 0]), WebGPUConstants.BufferUsage.Uniform | WebGPUConstants.BufferUsage.CopyDst);\r\n\r\n                if (this.dbgVerboseLogsForFirstFrames) {\r\n                    if ((this as any)._count === undefined) {\r\n                        (this as any)._count = 0;\r\n                        console.log(\"%c frame #\" + (this as any)._count + \" - begin\", \"background: #ffff00\");\r\n                    }\r\n                }\r\n\r\n                this._uploadEncoder = this._device.createCommandEncoder(this._uploadEncoderDescriptor);\r\n                this._renderEncoder = this._device.createCommandEncoder(this._renderEncoderDescriptor);\r\n                this._renderTargetEncoder = this._device.createCommandEncoder(this._renderTargetEncoderDescriptor);\r\n\r\n                this._emptyVertexBuffer = new VertexBuffer(this, [0], \"\", false, false, 1, false, 0, 1);\r\n\r\n                this._initializeLimits();\r\n\r\n                this._cacheRenderPipeline = new WebGPUCacheRenderPipelineTree(this._device, this._emptyVertexBuffer, !this._caps.textureFloatLinearFiltering);\r\n\r\n                this._depthCullingState = new WebGPUDepthCullingState(this._cacheRenderPipeline);\r\n                this._stencilStateComposer = new WebGPUStencilStateComposer(this._cacheRenderPipeline);\r\n                this._stencilStateComposer.stencilGlobal = this._stencilState;\r\n\r\n                this._depthCullingState.depthTest = true;\r\n                this._depthCullingState.depthFunc = Constants.LEQUAL;\r\n                this._depthCullingState.depthMask = true;\r\n\r\n                this._textureHelper.setCommandEncoder(this._uploadEncoder);\r\n\r\n                this._clearQuad = new WebGPUClearQuad(this._device, this, this._emptyVertexBuffer);\r\n                this._defaultDrawContext = this.createDrawContext()!;\r\n                this._currentDrawContext = this._defaultDrawContext;\r\n                this._defaultMaterialContext = this.createMaterialContext()!;\r\n                this._currentMaterialContext = this._defaultMaterialContext;\r\n\r\n                this._initializeContextAndSwapChain();\r\n                this._initializeMainAttachments();\r\n                this.resize();\r\n            })\r\n            .catch((e: any) => {\r\n                Logger.Error(\"Can not create WebGPU Device and/or context.\");\r\n                Logger.Error(e);\r\n                if (console.trace) {\r\n                    console.trace();\r\n                }\r\n            });\r\n    }\r\n\r\n    private _initGlslang(glslangOptions?: GlslangOptions): Promise<any> {\r\n        glslangOptions = glslangOptions || {};\r\n        glslangOptions = {\r\n            ...WebGPUEngine._GLSLslangDefaultOptions,\r\n            ...glslangOptions,\r\n        };\r\n\r\n        if (glslangOptions.glslang) {\r\n            return Promise.resolve(glslangOptions.glslang);\r\n        }\r\n\r\n        if ((self as any).glslang) {\r\n            return (self as any).glslang(glslangOptions!.wasmPath);\r\n        }\r\n\r\n        if (glslangOptions.jsPath && glslangOptions.wasmPath) {\r\n            if (IsWindowObjectExist()) {\r\n                return Tools.LoadScriptAsync(glslangOptions.jsPath).then(() => {\r\n                    return (self as any).glslang(glslangOptions!.wasmPath);\r\n                });\r\n            } else {\r\n                importScripts(glslangOptions.jsPath);\r\n                return (self as any).glslang(glslangOptions!.wasmPath);\r\n            }\r\n        }\r\n\r\n        return Promise.reject(\"gslang is not available.\");\r\n    }\r\n\r\n    private _initializeLimits(): void {\r\n        // Init caps\r\n        // TODO WEBGPU Real Capability check once limits will be working.\r\n\r\n        this._caps = {\r\n            maxTexturesImageUnits: 16,\r\n            maxVertexTextureImageUnits: 16,\r\n            maxCombinedTexturesImageUnits: 32,\r\n            maxTextureSize: 8192,\r\n            maxCubemapTextureSize: 2048,\r\n            maxRenderTextureSize: 8192,\r\n            maxVertexAttribs: 16,\r\n            maxVaryingVectors: 15,\r\n            maxFragmentUniformVectors: 1024,\r\n            maxVertexUniformVectors: 1024,\r\n            standardDerivatives: true,\r\n            astc: (this._deviceEnabledExtensions.indexOf(WebGPUConstants.FeatureName.TextureCompressionASTC) >= 0 ? true : undefined) as any,\r\n            s3tc: (this._deviceEnabledExtensions.indexOf(WebGPUConstants.FeatureName.TextureCompressionBC) >= 0 ? true : undefined) as any,\r\n            pvrtc: null,\r\n            etc1: null,\r\n            etc2: (this._deviceEnabledExtensions.indexOf(WebGPUConstants.FeatureName.TextureCompressionETC2) >= 0 ? true : undefined) as any,\r\n            bptc: this._deviceEnabledExtensions.indexOf(WebGPUConstants.FeatureName.TextureCompressionBC) >= 0 ? true : undefined,\r\n            maxAnisotropy: 4, // the spec only supports values of 1 and 4\r\n            uintIndices: true,\r\n            fragmentDepthSupported: true,\r\n            highPrecisionShaderSupported: true,\r\n            colorBufferFloat: true,\r\n            textureFloat: true,\r\n            textureFloatLinearFiltering: false, // WebGPU does not allow filtering 32 bits float textures\r\n            textureFloatRender: true,\r\n            textureHalfFloat: true,\r\n            textureHalfFloatLinearFiltering: true,\r\n            textureHalfFloatRender: true,\r\n            textureLOD: true,\r\n            drawBuffersExtension: true,\r\n            depthTextureExtension: true,\r\n            vertexArrayObject: false,\r\n            instancedArrays: true,\r\n            timerQuery: typeof BigUint64Array !== \"undefined\" && this.enabledExtensions.indexOf(WebGPUConstants.FeatureName.TimestampQuery) !== -1 ? (true as any) : undefined,\r\n            supportOcclusionQuery: typeof BigUint64Array !== \"undefined\",\r\n            canUseTimestampForTimerQuery: true,\r\n            multiview: false,\r\n            oculusMultiview: false,\r\n            parallelShaderCompile: undefined,\r\n            blendMinMax: true,\r\n            maxMSAASamples: 4,\r\n            canUseGLInstanceID: true,\r\n            canUseGLVertexID: true,\r\n            supportComputeShaders: true,\r\n            supportSRGBBuffers: true,\r\n            supportTransformFeedbacks: false,\r\n            textureMaxLevel: true,\r\n        };\r\n\r\n        this._caps.parallelShaderCompile = null as any;\r\n\r\n        this._features = {\r\n            forceBitmapOverHTMLImageElement: true,\r\n            supportRenderAndCopyToLodForFloatTextures: true,\r\n            supportDepthStencilTexture: true,\r\n            supportShadowSamplers: true,\r\n            uniformBufferHardCheckMatrix: false,\r\n            allowTexturePrefiltering: true,\r\n            trackUbosInFrame: true,\r\n            checkUbosContentBeforeUpload: true,\r\n            supportCSM: true,\r\n            basisNeedsPOT: false,\r\n            support3DTextures: true,\r\n            needTypeSuffixInShaderConstants: true,\r\n            supportMSAA: true,\r\n            supportSSAO2: true,\r\n            supportExtendedTextureFormats: true,\r\n            supportSwitchCaseInShader: true,\r\n            supportSyncTextureRead: false,\r\n            needsInvertingBitmap: false,\r\n            useUBOBindingCache: false,\r\n            needShaderCodeInlining: true,\r\n            needToAlwaysBindUniformBuffers: true,\r\n            supportRenderPasses: true,\r\n            _collectUbosUpdatedInFrame: false,\r\n        };\r\n    }\r\n\r\n    private _initializeContextAndSwapChain(): void {\r\n        this._context = this._canvas.getContext(\"webgpu\") as unknown as GPUCanvasContext;\r\n        this._configureContext(this._canvas.width, this._canvas.height);\r\n        this._colorFormat = this._options.swapChainFormat!;\r\n        this._mainRenderPassWrapper.colorAttachmentGPUTextures = [new WebGPUHardwareTexture()];\r\n        this._mainRenderPassWrapper.colorAttachmentGPUTextures[0]!.format = this._colorFormat;\r\n    }\r\n\r\n    // Set default values as WebGL with depth and stencil attachment for the broadest Compat.\r\n    private _initializeMainAttachments(): void {\r\n        this._mainTextureExtends = {\r\n            width: this.getRenderWidth(),\r\n            height: this.getRenderHeight(),\r\n            depthOrArrayLayers: 1,\r\n        };\r\n\r\n        const bufferDataUpdate = new Float32Array([this.getRenderHeight()]);\r\n\r\n        this._bufferManager.setSubData(this._ubInvertY, 4, bufferDataUpdate);\r\n        this._bufferManager.setSubData(this._ubDontInvertY, 4, bufferDataUpdate);\r\n\r\n        let mainColorAttachments: GPURenderPassColorAttachment[];\r\n\r\n        if (this._options.antialiasing) {\r\n            const mainTextureDescriptor: GPUTextureDescriptor = {\r\n                size: this._mainTextureExtends,\r\n                mipLevelCount: 1,\r\n                sampleCount: this._mainPassSampleCount,\r\n                dimension: WebGPUConstants.TextureDimension.E2d,\r\n                format: this._options.swapChainFormat!,\r\n                usage: WebGPUConstants.TextureUsage.RenderAttachment,\r\n            };\r\n\r\n            this._mainTexture?.destroy();\r\n            this._mainTexture = this._device.createTexture(mainTextureDescriptor);\r\n            mainColorAttachments = [\r\n                {\r\n                    view: this._mainTexture.createView(),\r\n                    clearValue: new Color4(0, 0, 0, 1),\r\n                    loadOp: WebGPUConstants.LoadOp.Clear,\r\n                    storeOp: WebGPUConstants.StoreOp.Store, // don't use StoreOp.Discard, else using several cameras with different viewports or using scissors will fail because we call beginRenderPass / endPass several times for the same color attachment!\r\n                },\r\n            ];\r\n        } else {\r\n            mainColorAttachments = [\r\n                {\r\n                    view: undefined as any,\r\n                    clearValue: new Color4(0, 0, 0, 1),\r\n                    loadOp: WebGPUConstants.LoadOp.Clear,\r\n                    storeOp: WebGPUConstants.StoreOp.Store,\r\n                },\r\n            ];\r\n        }\r\n\r\n        this._mainRenderPassWrapper.depthTextureFormat = this.isStencilEnable ? WebGPUConstants.TextureFormat.Depth24PlusStencil8 : WebGPUConstants.TextureFormat.Depth32Float;\r\n\r\n        this._setDepthTextureFormat(this._mainRenderPassWrapper);\r\n\r\n        const depthTextureDescriptor: GPUTextureDescriptor = {\r\n            size: this._mainTextureExtends,\r\n            mipLevelCount: 1,\r\n            sampleCount: this._mainPassSampleCount,\r\n            dimension: WebGPUConstants.TextureDimension.E2d,\r\n            format: this._mainRenderPassWrapper.depthTextureFormat,\r\n            usage: WebGPUConstants.TextureUsage.RenderAttachment,\r\n        };\r\n\r\n        if (this._depthTexture) {\r\n            this._depthTexture.destroy();\r\n        }\r\n        this._depthTexture = this._device.createTexture(depthTextureDescriptor);\r\n        const mainDepthAttachment: GPURenderPassDepthStencilAttachment = {\r\n            view: this._depthTexture.createView(),\r\n\r\n            depthClearValue: this._clearDepthValue,\r\n            depthLoadOp: WebGPUConstants.LoadOp.Clear,\r\n            depthStoreOp: WebGPUConstants.StoreOp.Store,\r\n            stencilClearValue: this._clearStencilValue,\r\n            stencilLoadOp: !this.isStencilEnable ? undefined : WebGPUConstants.LoadOp.Clear,\r\n            stencilStoreOp: !this.isStencilEnable ? undefined : WebGPUConstants.StoreOp.Store,\r\n        };\r\n\r\n        this._mainRenderPassWrapper.renderPassDescriptor = {\r\n            colorAttachments: mainColorAttachments,\r\n            depthStencilAttachment: mainDepthAttachment,\r\n        };\r\n\r\n        if (this._mainRenderPassWrapper.renderPass !== null) {\r\n            this._endMainRenderPass();\r\n        }\r\n    }\r\n\r\n    private _configureContext(width: number, height: number): void {\r\n        this._context.configure({\r\n            device: this._device,\r\n            format: this._options.swapChainFormat!,\r\n            usage: WebGPUConstants.TextureUsage.RenderAttachment | WebGPUConstants.TextureUsage.CopySrc,\r\n            compositingAlphaMode: this.premultipliedAlpha ? WebGPUConstants.CanvasCompositingAlphaMode.Premultiplied : WebGPUConstants.CanvasCompositingAlphaMode.Opaque,\r\n            size: {\r\n                width,\r\n                height,\r\n                depthOrArrayLayers: 1,\r\n            },\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Force a specific size of the canvas\r\n     * @param width defines the new canvas' width\r\n     * @param height defines the new canvas' height\r\n     * @param forceSetSize true to force setting the sizes of the underlying canvas\r\n     * @returns true if the size was changed\r\n     */\r\n    public setSize(width: number, height: number, forceSetSize = false): boolean {\r\n        if (!super.setSize(width, height, forceSetSize)) {\r\n            return false;\r\n        }\r\n\r\n        if (this.dbgVerboseLogsForFirstFrames) {\r\n            if ((this as any)._count === undefined) {\r\n                (this as any)._count = 0;\r\n            }\r\n            if (!(this as any)._count || (this as any)._count < this.dbgVerboseLogsNumFrames) {\r\n                console.log(\"frame #\" + (this as any)._count + \" - setSize called -\", width, height);\r\n            }\r\n        }\r\n\r\n        this._configureContext(width, height);\r\n        this._initializeMainAttachments();\r\n\r\n        if (this.snapshotRendering) {\r\n            // reset snapshot rendering so that the next frame will record a new list of bundles\r\n            this.snapshotRenderingReset();\r\n        }\r\n\r\n        return true;\r\n    }\r\n\r\n    private _shaderProcessorWGSL: Nullable<IShaderProcessor>;\r\n\r\n    /**\r\n     * @param shaderLanguage\r\n     * @hidden\r\n     */\r\n    public _getShaderProcessor(shaderLanguage: ShaderLanguage): Nullable<IShaderProcessor> {\r\n        if (shaderLanguage === ShaderLanguage.WGSL) {\r\n            return this._shaderProcessorWGSL;\r\n        }\r\n        return this._shaderProcessor;\r\n    }\r\n\r\n    /**\r\n     * @param shaderLanguage\r\n     * @hidden\r\n     */\r\n    public _getShaderProcessingContext(shaderLanguage: ShaderLanguage): Nullable<ShaderProcessingContext> {\r\n        return new WebGPUShaderProcessingContext(shaderLanguage);\r\n    }\r\n\r\n    //------------------------------------------------------------------------------\r\n    //                          Static Pipeline WebGPU States\r\n    //------------------------------------------------------------------------------\r\n\r\n    /** @hidden */\r\n    public applyStates() {\r\n        this._stencilStateComposer.apply();\r\n        this._cacheRenderPipeline.setAlphaBlendEnabled(this._alphaState.alphaBlend);\r\n    }\r\n\r\n    /**\r\n     * Force the entire cache to be cleared\r\n     * You should not have to use this function unless your engine needs to share the WebGPU context with another engine\r\n     * @param bruteForce defines a boolean to force clearing ALL caches (including stencil, detoh and alpha states)\r\n     */\r\n    public wipeCaches(bruteForce?: boolean): void {\r\n        if (this.preventCacheWipeBetweenFrames && !bruteForce) {\r\n            return;\r\n        }\r\n\r\n        //this._currentEffect = null; // can't reset _currentEffect, else some crashes can occur (for eg in ProceduralTexture which calls bindFrameBuffer (which calls wipeCaches) after having called enableEffect and before drawing into the texture)\r\n        // _forceEnableEffect = true assumes the role of _currentEffect = null\r\n        this._forceEnableEffect = true;\r\n        this._currentIndexBuffer = null;\r\n        this._currentOverrideVertexBuffers = null;\r\n        this._cacheRenderPipeline.setBuffers(null, null, null);\r\n\r\n        if (bruteForce) {\r\n            this._stencilStateComposer.reset();\r\n\r\n            this._depthCullingState.reset();\r\n            this._depthCullingState.depthFunc = Constants.LEQUAL;\r\n\r\n            this._alphaState.reset();\r\n            this._alphaMode = Constants.ALPHA_ADD;\r\n            this._alphaEquation = Constants.ALPHA_DISABLE;\r\n            this._cacheRenderPipeline.setAlphaBlendFactors(this._alphaState._blendFunctionParameters, this._alphaState._blendEquationParameters);\r\n            this._cacheRenderPipeline.setAlphaBlendEnabled(false);\r\n\r\n            this.setColorWrite(true);\r\n        }\r\n\r\n        this._cachedVertexBuffers = null;\r\n        this._cachedIndexBuffer = null;\r\n        this._cachedEffectForVertexBuffers = null;\r\n    }\r\n\r\n    /**\r\n     * Enable or disable color writing\r\n     * @param enable defines the state to set\r\n     */\r\n    public setColorWrite(enable: boolean): void {\r\n        this._colorWriteLocal = enable;\r\n        this._cacheRenderPipeline.setWriteMask(enable ? 0xf : 0);\r\n    }\r\n\r\n    /**\r\n     * Gets a boolean indicating if color writing is enabled\r\n     * @returns the current color writing state\r\n     */\r\n    public getColorWrite(): boolean {\r\n        return this._colorWriteLocal;\r\n    }\r\n\r\n    //------------------------------------------------------------------------------\r\n    //                              Dynamic WebGPU States\r\n    //------------------------------------------------------------------------------\r\n\r\n    // index 0 is for main render pass, 1 for RTT render pass\r\n    private _viewportsCurrent: Array<{ x: number; y: number; w: number; h: number }> = [\r\n        { x: 0, y: 0, w: 0, h: 0 },\r\n        { x: 0, y: 0, w: 0, h: 0 },\r\n    ];\r\n\r\n    private _resetCurrentViewport(index: number) {\r\n        this._viewportsCurrent[index].x = 0;\r\n        this._viewportsCurrent[index].y = 0;\r\n        this._viewportsCurrent[index].w = 0;\r\n        this._viewportsCurrent[index].h = 0;\r\n\r\n        if (index === 1) {\r\n            this._viewportCached.x = 0;\r\n            this._viewportCached.y = 0;\r\n            this._viewportCached.z = 0;\r\n            this._viewportCached.w = 0;\r\n        }\r\n    }\r\n\r\n    private _mustUpdateViewport(renderPass: GPURenderPassEncoder): boolean {\r\n        const index = renderPass === this._mainRenderPassWrapper.renderPass ? 0 : 1;\r\n\r\n        const x = this._viewportCached.x,\r\n            y = this._viewportCached.y,\r\n            w = this._viewportCached.z,\r\n            h = this._viewportCached.w;\r\n\r\n        const update =\r\n            this._viewportsCurrent[index].x !== x || this._viewportsCurrent[index].y !== y || this._viewportsCurrent[index].w !== w || this._viewportsCurrent[index].h !== h;\r\n\r\n        if (update) {\r\n            this._viewportsCurrent[index].x = this._viewportCached.x;\r\n            this._viewportsCurrent[index].y = this._viewportCached.y;\r\n            this._viewportsCurrent[index].w = this._viewportCached.z;\r\n            this._viewportsCurrent[index].h = this._viewportCached.w;\r\n        }\r\n\r\n        return update;\r\n    }\r\n\r\n    private _applyViewport(renderPass: GPURenderPassEncoder): void {\r\n        let y = Math.floor(this._viewportCached.y);\r\n        const h = Math.floor(this._viewportCached.w);\r\n\r\n        if (!this._currentRenderTarget) {\r\n            y = this.getRenderHeight() - y - h;\r\n        }\r\n\r\n        renderPass.setViewport(Math.floor(this._viewportCached.x), y, Math.floor(this._viewportCached.z), h, 0, 1);\r\n\r\n        if (this.dbgVerboseLogsForFirstFrames) {\r\n            if ((this as any)._count === undefined) {\r\n                (this as any)._count = 0;\r\n            }\r\n            if (!(this as any)._count || (this as any)._count < this.dbgVerboseLogsNumFrames) {\r\n                console.log(\r\n                    \"frame #\" + (this as any)._count + \" - viewport applied - (\",\r\n                    this._viewportCached.x,\r\n                    this._viewportCached.y,\r\n                    this._viewportCached.z,\r\n                    this._viewportCached.w,\r\n                    \") current pass is main pass=\" + (renderPass === this._mainRenderPassWrapper.renderPass)\r\n                );\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @param x\r\n     * @param y\r\n     * @param width\r\n     * @param height\r\n     * @hidden\r\n     */\r\n    public _viewport(x: number, y: number, width: number, height: number): void {\r\n        this._viewportCached.x = x;\r\n        this._viewportCached.y = y;\r\n        this._viewportCached.z = width;\r\n        this._viewportCached.w = height;\r\n    }\r\n\r\n    private _scissorsCurrent: Array<{ x: number; y: number; w: number; h: number }> = [\r\n        { x: 0, y: 0, w: 0, h: 0 },\r\n        { x: 0, y: 0, w: 0, h: 0 },\r\n    ];\r\n    protected _scissorCached = { x: 0, y: 0, z: 0, w: 0 };\r\n\r\n    private _resetCurrentScissor(index: number) {\r\n        this._scissorsCurrent[index].x = 0;\r\n        this._scissorsCurrent[index].y = 0;\r\n        this._scissorsCurrent[index].w = 0;\r\n        this._scissorsCurrent[index].h = 0;\r\n    }\r\n\r\n    private _mustUpdateScissor(renderPass: GPURenderPassEncoder): boolean {\r\n        const index = renderPass === this._mainRenderPassWrapper.renderPass ? 0 : 1;\r\n\r\n        const x = this._scissorCached.x,\r\n            y = this._scissorCached.y,\r\n            w = this._scissorCached.z,\r\n            h = this._scissorCached.w;\r\n\r\n        const update = this._scissorsCurrent[index].x !== x || this._scissorsCurrent[index].y !== y || this._scissorsCurrent[index].w !== w || this._scissorsCurrent[index].h !== h;\r\n\r\n        if (update) {\r\n            this._scissorsCurrent[index].x = this._scissorCached.x;\r\n            this._scissorsCurrent[index].y = this._scissorCached.y;\r\n            this._scissorsCurrent[index].w = this._scissorCached.z;\r\n            this._scissorsCurrent[index].h = this._scissorCached.w;\r\n        }\r\n\r\n        return update;\r\n    }\r\n\r\n    private _applyScissor(renderPass: GPURenderPassEncoder): void {\r\n        renderPass.setScissorRect(\r\n            this._scissorCached.x,\r\n            this._currentRenderTarget ? this._scissorCached.y : this.getRenderHeight() - this._scissorCached.w - this._scissorCached.y,\r\n            this._scissorCached.z,\r\n            this._scissorCached.w\r\n        );\r\n\r\n        if (this.dbgVerboseLogsForFirstFrames) {\r\n            if ((this as any)._count === undefined) {\r\n                (this as any)._count = 0;\r\n            }\r\n            if (!(this as any)._count || (this as any)._count < this.dbgVerboseLogsNumFrames) {\r\n                console.log(\r\n                    \"frame #\" + (this as any)._count + \" - scissor applied - (\",\r\n                    this._scissorCached.x,\r\n                    this._scissorCached.y,\r\n                    this._scissorCached.z,\r\n                    this._scissorCached.w,\r\n                    \") current pass is main pass=\" + (renderPass === this._mainRenderPassWrapper.renderPass)\r\n                );\r\n            }\r\n        }\r\n    }\r\n\r\n    private _scissorIsActive() {\r\n        return this._scissorCached.x !== 0 || this._scissorCached.y !== 0 || this._scissorCached.z !== 0 || this._scissorCached.w !== 0;\r\n    }\r\n\r\n    public enableScissor(x: number, y: number, width: number, height: number): void {\r\n        this._scissorCached.x = x;\r\n        this._scissorCached.y = y;\r\n        this._scissorCached.z = width;\r\n        this._scissorCached.w = height;\r\n    }\r\n\r\n    public disableScissor() {\r\n        this._scissorCached.x = 0;\r\n        this._scissorCached.y = 0;\r\n        this._scissorCached.z = 0;\r\n        this._scissorCached.w = 0;\r\n\r\n        this._resetCurrentScissor(0);\r\n        this._resetCurrentScissor(1);\r\n    }\r\n\r\n    private _stencilRefsCurrent: Array<number> = [-1, -1];\r\n\r\n    private _resetCurrentStencilRef(index: number): void {\r\n        this._stencilRefsCurrent[index] = -1;\r\n    }\r\n\r\n    private _mustUpdateStencilRef(renderPass: GPURenderPassEncoder): boolean {\r\n        const index = renderPass === this._mainRenderPassWrapper.renderPass ? 0 : 1;\r\n        const update = this._stencilStateComposer.funcRef !== this._stencilRefsCurrent[index];\r\n        if (update) {\r\n            this._stencilRefsCurrent[index] = this._stencilStateComposer.funcRef;\r\n        }\r\n        return update;\r\n    }\r\n\r\n    /**\r\n     * @param renderPass\r\n     * @hidden\r\n     */\r\n    public _applyStencilRef(renderPass: GPURenderPassEncoder): void {\r\n        renderPass.setStencilReference(this._stencilStateComposer.funcRef ?? 0);\r\n    }\r\n\r\n    private _blendColorsCurrent: Array<Array<Nullable<number>>> = [\r\n        [null, null, null, null],\r\n        [null, null, null, null],\r\n    ];\r\n\r\n    private _resetCurrentColorBlend(index: number): void {\r\n        this._blendColorsCurrent[index][0] = this._blendColorsCurrent[index][1] = this._blendColorsCurrent[index][2] = this._blendColorsCurrent[index][3] = null;\r\n    }\r\n\r\n    private _mustUpdateBlendColor(renderPass: GPURenderPassEncoder): boolean {\r\n        const index = renderPass === this._mainRenderPassWrapper.renderPass ? 0 : 1;\r\n        const colorBlend = this._alphaState._blendConstants;\r\n\r\n        const update =\r\n            colorBlend[0] !== this._blendColorsCurrent[index][0] ||\r\n            colorBlend[1] !== this._blendColorsCurrent[index][1] ||\r\n            colorBlend[2] !== this._blendColorsCurrent[index][2] ||\r\n            colorBlend[3] !== this._blendColorsCurrent[index][3];\r\n\r\n        if (update) {\r\n            this._blendColorsCurrent[index][0] = colorBlend[0];\r\n            this._blendColorsCurrent[index][1] = colorBlend[1];\r\n            this._blendColorsCurrent[index][2] = colorBlend[2];\r\n            this._blendColorsCurrent[index][3] = colorBlend[3];\r\n        }\r\n\r\n        return update;\r\n    }\r\n\r\n    private _applyBlendColor(renderPass: GPURenderPassEncoder): void {\r\n        renderPass.setBlendConstant(this._alphaState._blendConstants as GPUColor);\r\n    }\r\n\r\n    /**\r\n     * Clear the current render buffer or the current render target (if any is set up)\r\n     * @param color defines the color to use\r\n     * @param backBuffer defines if the back buffer must be cleared\r\n     * @param depth defines if the depth buffer must be cleared\r\n     * @param stencil defines if the stencil buffer must be cleared\r\n     */\r\n    public clear(color: Nullable<IColor4Like>, backBuffer: boolean, depth: boolean, stencil: boolean = false): void {\r\n        // Some PGs are using color3...\r\n        if (color && color.a === undefined) {\r\n            color.a = 1;\r\n        }\r\n\r\n        const hasScissor = this._scissorIsActive();\r\n\r\n        if (this.dbgVerboseLogsForFirstFrames) {\r\n            if ((this as any)._count === undefined) {\r\n                (this as any)._count = 0;\r\n            }\r\n            if (!(this as any)._count || (this as any)._count < this.dbgVerboseLogsNumFrames) {\r\n                console.log(\r\n                    \"frame #\" + (this as any)._count + \" - clear called - backBuffer=\",\r\n                    backBuffer,\r\n                    \" depth=\",\r\n                    depth,\r\n                    \" stencil=\",\r\n                    stencil,\r\n                    \" scissor is active=\",\r\n                    hasScissor\r\n                );\r\n            }\r\n        }\r\n\r\n        // We need to recreate the render pass so that the new parameters for clear color / depth / stencil are taken into account\r\n        if (this._currentRenderTarget) {\r\n            if (hasScissor) {\r\n                if (!this._rttRenderPassWrapper.renderPass) {\r\n                    this._startRenderTargetRenderPass(this._currentRenderTarget!, false, backBuffer ? color : null, depth, stencil);\r\n                }\r\n                if (!this.compatibilityMode) {\r\n                    this._bundleListRenderTarget.addItem(new WebGPURenderItemScissor(this._scissorCached.x, this._scissorCached.y, this._scissorCached.z, this._scissorCached.w));\r\n                } else {\r\n                    this._applyScissor(this._currentRenderPass!);\r\n                }\r\n                this._clearFullQuad(backBuffer ? color : null, depth, stencil);\r\n            } else {\r\n                if (this._currentRenderPass) {\r\n                    this._endRenderTargetRenderPass();\r\n                }\r\n                this._startRenderTargetRenderPass(this._currentRenderTarget!, true, backBuffer ? color : null, depth, stencil);\r\n            }\r\n        } else {\r\n            if (!this._mainRenderPassWrapper.renderPass || !hasScissor) {\r\n                this._startMainRenderPass(!hasScissor, backBuffer ? color : null, depth, stencil);\r\n            }\r\n            if (hasScissor) {\r\n                if (!this.compatibilityMode) {\r\n                    this._bundleList.addItem(new WebGPURenderItemScissor(this._scissorCached.x, this._scissorCached.y, this._scissorCached.z, this._scissorCached.w));\r\n                } else {\r\n                    this._applyScissor(this._currentRenderPass!);\r\n                }\r\n                this._clearFullQuad(backBuffer ? color : null, depth, stencil);\r\n            }\r\n        }\r\n    }\r\n\r\n    private _clearFullQuad(clearColor?: Nullable<IColor4Like>, clearDepth?: boolean, clearStencil?: boolean): void {\r\n        const renderPass = !this.compatibilityMode ? null : this._getCurrentRenderPass();\r\n        const renderPassIndex = this._getCurrentRenderPassIndex();\r\n        const bundleList = renderPassIndex === 0 ? this._bundleList : this._bundleListRenderTarget;\r\n\r\n        this._clearQuad.setColorFormat(this._colorFormat);\r\n        this._clearQuad.setDepthStencilFormat(this._depthTextureFormat);\r\n        this._clearQuad.setMRTAttachments(\r\n            this._cacheRenderPipeline.mrtAttachments ?? [],\r\n            this._cacheRenderPipeline.mrtTextureArray ?? [],\r\n            this._cacheRenderPipeline.mrtTextureCount\r\n        );\r\n\r\n        if (!this.compatibilityMode) {\r\n            bundleList.addItem(new WebGPURenderItemStencilRef(this._clearStencilValue));\r\n        } else {\r\n            renderPass!.setStencilReference(this._clearStencilValue);\r\n        }\r\n\r\n        const bundle = this._clearQuad.clear(renderPass, clearColor, clearDepth, clearStencil, this.currentSampleCount);\r\n\r\n        if (!this.compatibilityMode) {\r\n            bundleList.addBundle(bundle!);\r\n            bundleList.addItem(new WebGPURenderItemStencilRef(this._stencilStateComposer.funcRef ?? 0));\r\n            this._reportDrawCall();\r\n        } else {\r\n            this._applyStencilRef(renderPass!);\r\n        }\r\n    }\r\n\r\n    //------------------------------------------------------------------------------\r\n    //                              Vertex/Index/Storage Buffers\r\n    //------------------------------------------------------------------------------\r\n\r\n    /**\r\n     * Creates a vertex buffer\r\n     * @param data the data for the vertex buffer\r\n     * @returns the new buffer\r\n     */\r\n    public createVertexBuffer(data: DataArray): DataBuffer {\r\n        let view: ArrayBufferView;\r\n\r\n        if (data instanceof Array) {\r\n            view = new Float32Array(data);\r\n        } else if (data instanceof ArrayBuffer) {\r\n            view = new Uint8Array(data);\r\n        } else {\r\n            view = data;\r\n        }\r\n\r\n        const dataBuffer = this._bufferManager.createBuffer(view, WebGPUConstants.BufferUsage.Vertex | WebGPUConstants.BufferUsage.CopyDst);\r\n        return dataBuffer;\r\n    }\r\n\r\n    /**\r\n     * Creates a vertex buffer\r\n     * @param data the data for the dynamic vertex buffer\r\n     * @returns the new buffer\r\n     */\r\n    public createDynamicVertexBuffer(data: DataArray): DataBuffer {\r\n        return this.createVertexBuffer(data);\r\n    }\r\n\r\n    /**\r\n     * Creates a new index buffer\r\n     * @param indices defines the content of the index buffer\r\n     * @returns a new buffer\r\n     */\r\n    public createIndexBuffer(indices: IndicesArray): DataBuffer {\r\n        let is32Bits = true;\r\n        let view: ArrayBufferView;\r\n\r\n        if (indices instanceof Uint32Array || indices instanceof Int32Array) {\r\n            view = indices;\r\n        } else if (indices instanceof Uint16Array) {\r\n            view = indices;\r\n            is32Bits = false;\r\n        } else {\r\n            if (indices.length > 65535) {\r\n                view = new Uint32Array(indices);\r\n            } else {\r\n                view = new Uint16Array(indices);\r\n                is32Bits = false;\r\n            }\r\n        }\r\n\r\n        const dataBuffer = this._bufferManager.createBuffer(view, WebGPUConstants.BufferUsage.Index | WebGPUConstants.BufferUsage.CopyDst);\r\n        dataBuffer.is32Bits = is32Bits;\r\n        return dataBuffer;\r\n    }\r\n\r\n    /**\r\n     * @param data\r\n     * @param creationFlags\r\n     * @hidden\r\n     */\r\n    public _createBuffer(data: DataArray | number, creationFlags: number): DataBuffer {\r\n        let view: ArrayBufferView | number;\r\n\r\n        if (data instanceof Array) {\r\n            view = new Float32Array(data);\r\n        } else if (data instanceof ArrayBuffer) {\r\n            view = new Uint8Array(data);\r\n        } else {\r\n            view = data;\r\n        }\r\n\r\n        let flags = 0;\r\n        if (creationFlags & Constants.BUFFER_CREATIONFLAG_READ) {\r\n            flags |= WebGPUConstants.BufferUsage.CopySrc;\r\n        }\r\n        if (creationFlags & Constants.BUFFER_CREATIONFLAG_WRITE) {\r\n            flags |= WebGPUConstants.BufferUsage.CopyDst;\r\n        }\r\n        if (creationFlags & Constants.BUFFER_CREATIONFLAG_UNIFORM) {\r\n            flags |= WebGPUConstants.BufferUsage.Uniform;\r\n        }\r\n        if (creationFlags & Constants.BUFFER_CREATIONFLAG_VERTEX) {\r\n            flags |= WebGPUConstants.BufferUsage.Vertex;\r\n        }\r\n        if (creationFlags & Constants.BUFFER_CREATIONFLAG_INDEX) {\r\n            flags |= WebGPUConstants.BufferUsage.Index;\r\n        }\r\n        if (creationFlags & Constants.BUFFER_CREATIONFLAG_STORAGE) {\r\n            flags |= WebGPUConstants.BufferUsage.Storage;\r\n        }\r\n\r\n        return this._bufferManager.createBuffer(view, flags);\r\n    }\r\n\r\n    /**\r\n     * @hidden\r\n     */\r\n    public bindBuffersDirectly(): void {\r\n        throw \"Not implemented on WebGPU\";\r\n    }\r\n\r\n    /**\r\n     * @hidden\r\n     */\r\n    public updateAndBindInstancesBuffer(): void {\r\n        throw \"Not implemented on WebGPU\";\r\n    }\r\n\r\n    /**\r\n     * Bind a list of vertex buffers with the engine\r\n     * @param vertexBuffers defines the list of vertex buffers to bind\r\n     * @param indexBuffer defines the index buffer to bind\r\n     * @param effect defines the effect associated with the vertex buffers\r\n     * @param overrideVertexBuffers defines optional list of avertex buffers that overrides the entries in vertexBuffers\r\n     */\r\n    public bindBuffers(\r\n        vertexBuffers: { [key: string]: Nullable<VertexBuffer> },\r\n        indexBuffer: Nullable<DataBuffer>,\r\n        effect: Effect,\r\n        overrideVertexBuffers?: { [kind: string]: Nullable<VertexBuffer> }\r\n    ): void {\r\n        this._currentIndexBuffer = indexBuffer;\r\n        this._currentOverrideVertexBuffers = overrideVertexBuffers ?? null;\r\n        this._cacheRenderPipeline.setBuffers(vertexBuffers, indexBuffer, this._currentOverrideVertexBuffers);\r\n    }\r\n\r\n    /**\r\n     * @param buffer\r\n     * @hidden\r\n     */\r\n    public _releaseBuffer(buffer: DataBuffer): boolean {\r\n        return this._bufferManager.releaseBuffer(buffer);\r\n    }\r\n\r\n    //------------------------------------------------------------------------------\r\n    //                              Effects\r\n    //------------------------------------------------------------------------------\r\n\r\n    /**\r\n     * Create a new effect (used to store vertex/fragment shaders)\r\n     * @param baseName defines the base name of the effect (The name of file without .fragment.fx or .vertex.fx)\r\n     * @param attributesNamesOrOptions defines either a list of attribute names or an IEffectCreationOptions object\r\n     * @param uniformsNamesOrEngine defines either a list of uniform names or the engine to use\r\n     * @param samplers defines an array of string used to represent textures\r\n     * @param defines defines the string containing the defines to use to compile the shaders\r\n     * @param fallbacks defines the list of potential fallbacks to use if shader compilation fails\r\n     * @param onCompiled defines a function to call when the effect creation is successful\r\n     * @param onError defines a function to call when the effect creation has failed\r\n     * @param indexParameters defines an object containing the index values to use to compile shaders (like the maximum number of simultaneous lights)\r\n     * @param shaderLanguage the language the shader is written in (default: GLSL)\r\n     * @returns the new Effect\r\n     */\r\n    public createEffect(\r\n        baseName: any,\r\n        attributesNamesOrOptions: string[] | IEffectCreationOptions,\r\n        uniformsNamesOrEngine: string[] | Engine,\r\n        samplers?: string[],\r\n        defines?: string,\r\n        fallbacks?: EffectFallbacks,\r\n        onCompiled?: Nullable<(effect: Effect) => void>,\r\n        onError?: Nullable<(effect: Effect, errors: string) => void>,\r\n        indexParameters?: any,\r\n        shaderLanguage = ShaderLanguage.GLSL\r\n    ): Effect {\r\n        const vertex = baseName.vertexElement || baseName.vertex || baseName.vertexToken || baseName.vertexSource || baseName;\r\n        const fragment = baseName.fragmentElement || baseName.fragment || baseName.fragmentToken || baseName.fragmentSource || baseName;\r\n        const globalDefines = this._getGlobalDefines()!;\r\n\r\n        let fullDefines = defines ?? (<IEffectCreationOptions>attributesNamesOrOptions).defines ?? \"\";\r\n\r\n        if (globalDefines) {\r\n            fullDefines += \"\\n\" + globalDefines;\r\n        }\r\n\r\n        const name = vertex + \"+\" + fragment + \"@\" + fullDefines;\r\n        if (this._compiledEffects[name]) {\r\n            const compiledEffect = <Effect>this._compiledEffects[name];\r\n            if (onCompiled && compiledEffect.isReady()) {\r\n                onCompiled(compiledEffect);\r\n            }\r\n\r\n            return compiledEffect;\r\n        }\r\n        const effect = new Effect(\r\n            baseName,\r\n            attributesNamesOrOptions,\r\n            uniformsNamesOrEngine,\r\n            samplers,\r\n            this,\r\n            defines,\r\n            fallbacks,\r\n            onCompiled,\r\n            onError,\r\n            indexParameters,\r\n            name,\r\n            shaderLanguage\r\n        );\r\n        this._compiledEffects[name] = effect;\r\n\r\n        return effect;\r\n    }\r\n\r\n    private _compileRawShaderToSpirV(source: string, type: string): Uint32Array {\r\n        return this._glslang.compileGLSL(source, type);\r\n    }\r\n\r\n    private _compileShaderToSpirV(source: string, type: string, defines: Nullable<string>, shaderVersion: string): Uint32Array {\r\n        return this._compileRawShaderToSpirV(shaderVersion + (defines ? defines + \"\\n\" : \"\") + source, type);\r\n    }\r\n\r\n    private _getWGSLShader(source: string, type: string, defines: Nullable<string>): string {\r\n        if (defines) {\r\n            defines = \"//\" + defines.split(\"\\n\").join(\"\\n//\") + \"\\n\";\r\n        } else {\r\n            defines = \"\";\r\n        }\r\n        return defines + source;\r\n    }\r\n\r\n    private _createPipelineStageDescriptor(\r\n        vertexShader: Uint32Array | string,\r\n        fragmentShader: Uint32Array | string,\r\n        shaderLanguage: ShaderLanguage\r\n    ): IWebGPURenderPipelineStageDescriptor {\r\n        if (this._tintWASM && shaderLanguage === ShaderLanguage.GLSL) {\r\n            vertexShader = this._tintWASM.convertSpirV2WGSL(vertexShader as Uint32Array) as any;\r\n            fragmentShader = this._tintWASM.convertSpirV2WGSL(fragmentShader as Uint32Array) as any;\r\n        }\r\n\r\n        return {\r\n            vertexStage: {\r\n                module: this._device.createShaderModule({\r\n                    code: vertexShader,\r\n                }),\r\n                entryPoint: \"main\",\r\n            },\r\n            fragmentStage: {\r\n                module: this._device.createShaderModule({\r\n                    code: fragmentShader,\r\n                }),\r\n                entryPoint: \"main\",\r\n            },\r\n        };\r\n    }\r\n\r\n    private _compileRawPipelineStageDescriptor(vertexCode: string, fragmentCode: string, shaderLanguage: ShaderLanguage): IWebGPURenderPipelineStageDescriptor {\r\n        const vertexShader = shaderLanguage === ShaderLanguage.GLSL ? this._compileRawShaderToSpirV(vertexCode, \"vertex\") : vertexCode;\r\n        const fragmentShader = shaderLanguage === ShaderLanguage.GLSL ? this._compileRawShaderToSpirV(fragmentCode, \"fragment\") : fragmentCode;\r\n\r\n        return this._createPipelineStageDescriptor(vertexShader, fragmentShader, shaderLanguage);\r\n    }\r\n\r\n    private _compilePipelineStageDescriptor(\r\n        vertexCode: string,\r\n        fragmentCode: string,\r\n        defines: Nullable<string>,\r\n        shaderLanguage: ShaderLanguage\r\n    ): IWebGPURenderPipelineStageDescriptor {\r\n        this.onBeforeShaderCompilationObservable.notifyObservers(this);\r\n\r\n        const shaderVersion = \"#version 450\\n\";\r\n        const vertexShader =\r\n            shaderLanguage === ShaderLanguage.GLSL ? this._compileShaderToSpirV(vertexCode, \"vertex\", defines, shaderVersion) : this._getWGSLShader(vertexCode, \"vertex\", defines);\r\n        const fragmentShader =\r\n            shaderLanguage === ShaderLanguage.GLSL\r\n                ? this._compileShaderToSpirV(fragmentCode, \"fragment\", defines, shaderVersion)\r\n                : this._getWGSLShader(fragmentCode, \"fragment\", defines);\r\n\r\n        const program = this._createPipelineStageDescriptor(vertexShader, fragmentShader, shaderLanguage);\r\n\r\n        this.onAfterShaderCompilationObservable.notifyObservers(this);\r\n\r\n        return program;\r\n    }\r\n\r\n    /**\r\n     * @hidden\r\n     */\r\n    public createRawShaderProgram(): WebGLProgram {\r\n        throw \"Not available on WebGPU\";\r\n    }\r\n\r\n    /**\r\n     * @hidden\r\n     */\r\n    public createShaderProgram(): WebGLProgram {\r\n        throw \"Not available on WebGPU\";\r\n    }\r\n\r\n    /**\r\n     * Inline functions in shader code that are marked to be inlined\r\n     * @param code code to inline\r\n     * @returns inlined code\r\n     */\r\n    public inlineShaderCode(code: string): string {\r\n        const sci = new ShaderCodeInliner(code);\r\n        sci.debug = false;\r\n        sci.processCode();\r\n        return sci.code;\r\n    }\r\n\r\n    /**\r\n     * Creates a new pipeline context\r\n     * @param shaderProcessingContext defines the shader processing context used during the processing if available\r\n     * @returns the new pipeline\r\n     */\r\n    public createPipelineContext(shaderProcessingContext: Nullable<ShaderProcessingContext>): IPipelineContext {\r\n        return new WebGPUPipelineContext(shaderProcessingContext! as WebGPUShaderProcessingContext, this);\r\n    }\r\n\r\n    /**\r\n     * Creates a new material context\r\n     * @returns the new context\r\n     */\r\n    public createMaterialContext(): WebGPUMaterialContext | undefined {\r\n        return new WebGPUMaterialContext();\r\n    }\r\n\r\n    /**\r\n     * Creates a new draw context\r\n     * @returns the new context\r\n     */\r\n    public createDrawContext(): WebGPUDrawContext | undefined {\r\n        return new WebGPUDrawContext(this._bufferManager);\r\n    }\r\n\r\n    /**\r\n     * @param pipelineContext\r\n     * @param vertexSourceCode\r\n     * @param fragmentSourceCode\r\n     * @param createAsRaw\r\n     * @param rawVertexSourceCode\r\n     * @param rawFragmentSourceCode\r\n     * @param rebuildRebind\r\n     * @param defines\r\n     * @hidden\r\n     */\r\n    public _preparePipelineContext(\r\n        pipelineContext: IPipelineContext,\r\n        vertexSourceCode: string,\r\n        fragmentSourceCode: string,\r\n        createAsRaw: boolean,\r\n        rawVertexSourceCode: string,\r\n        rawFragmentSourceCode: string,\r\n        rebuildRebind: any,\r\n        defines: Nullable<string>\r\n    ) {\r\n        const webGpuContext = pipelineContext as WebGPUPipelineContext;\r\n        const shaderLanguage = webGpuContext.shaderProcessingContext.shaderLanguage;\r\n\r\n        if (this.dbgShowShaderCode) {\r\n            console.log(defines);\r\n            console.log(vertexSourceCode);\r\n            console.log(fragmentSourceCode);\r\n        }\r\n\r\n        webGpuContext.sources = {\r\n            fragment: fragmentSourceCode,\r\n            vertex: vertexSourceCode,\r\n            rawVertex: rawVertexSourceCode,\r\n            rawFragment: rawFragmentSourceCode,\r\n        };\r\n\r\n        if (createAsRaw) {\r\n            webGpuContext.stages = this._compileRawPipelineStageDescriptor(vertexSourceCode, fragmentSourceCode, shaderLanguage);\r\n        } else {\r\n            webGpuContext.stages = this._compilePipelineStageDescriptor(vertexSourceCode, fragmentSourceCode, defines, shaderLanguage);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Gets the list of active attributes for a given WebGPU program\r\n     * @param pipelineContext defines the pipeline context to use\r\n     * @param attributesNames defines the list of attribute names to get\r\n     * @returns an array of indices indicating the offset of each attribute\r\n     */\r\n    public getAttributes(pipelineContext: IPipelineContext, attributesNames: string[]): number[] {\r\n        const results = new Array(attributesNames.length);\r\n        const gpuPipelineContext = pipelineContext as WebGPUPipelineContext;\r\n\r\n        for (let i = 0; i < attributesNames.length; i++) {\r\n            const attributeName = attributesNames[i];\r\n            const attributeLocation = gpuPipelineContext.shaderProcessingContext.availableAttributes[attributeName];\r\n            if (attributeLocation === undefined) {\r\n                continue;\r\n            }\r\n\r\n            results[i] = attributeLocation;\r\n        }\r\n\r\n        return results;\r\n    }\r\n\r\n    /**\r\n     * Activates an effect, making it the current one (ie. the one used for rendering)\r\n     * @param effect defines the effect to activate\r\n     */\r\n    public enableEffect(effect: Nullable<Effect | DrawWrapper>): void {\r\n        if (!effect) {\r\n            return;\r\n        }\r\n\r\n        let isNewEffect = true;\r\n\r\n        if (!DrawWrapper.IsWrapper(effect)) {\r\n            isNewEffect = effect !== this._currentEffect;\r\n            this._currentEffect = effect;\r\n            this._currentMaterialContext = this._defaultMaterialContext;\r\n            this._currentDrawContext = this._defaultDrawContext;\r\n            this._counters.numEnableEffects++;\r\n            if (this.dbgLogIfNotDrawWrapper) {\r\n                Logger.Warn(\r\n                    `enableEffect has been called with an Effect and not a Wrapper! effect.uniqueId=${effect.uniqueId}, effect.name=${effect.name}, effect.name.vertex=${effect.name.vertex}, effect.name.fragment=${effect.name.fragment}`,\r\n                    10\r\n                );\r\n            }\r\n        } else if (\r\n            !effect.effect ||\r\n            (effect.effect === this._currentEffect &&\r\n                effect.materialContext === this._currentMaterialContext &&\r\n                effect.drawContext === this._currentDrawContext &&\r\n                !this._forceEnableEffect)\r\n        ) {\r\n            if (!effect.effect && this.dbgShowEmptyEnableEffectCalls) {\r\n                console.error(\"drawWrapper=\", effect);\r\n                throw \"Invalid call to enableEffect: the effect property is empty!\";\r\n            }\r\n            return;\r\n        } else {\r\n            isNewEffect = effect.effect !== this._currentEffect;\r\n            this._currentEffect = effect.effect;\r\n            this._currentMaterialContext = effect.materialContext as WebGPUMaterialContext;\r\n            this._currentDrawContext = effect.drawContext as WebGPUDrawContext;\r\n            this._counters.numEnableDrawWrapper++;\r\n            if (!this._currentMaterialContext) {\r\n                console.error(\"drawWrapper=\", effect);\r\n                throw `Invalid call to enableEffect: the materialContext property is empty!`;\r\n            }\r\n        }\r\n\r\n        this._stencilStateComposer.stencilMaterial = undefined;\r\n\r\n        this._forceEnableEffect = isNewEffect || this._forceEnableEffect ? false : this._forceEnableEffect;\r\n\r\n        if (isNewEffect) {\r\n            if (this._currentEffect!.onBind) {\r\n                this._currentEffect!.onBind(this._currentEffect!);\r\n            }\r\n            if (this._currentEffect!._onBindObservable) {\r\n                this._currentEffect!._onBindObservable.notifyObservers(this._currentEffect!);\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @param effect\r\n     * @hidden\r\n     */\r\n    public _releaseEffect(effect: Effect): void {\r\n        if (this._compiledEffects[effect._key]) {\r\n            delete this._compiledEffects[effect._key];\r\n\r\n            this._deletePipelineContext(effect.getPipelineContext() as WebGPUPipelineContext);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Force the engine to release all cached effects. This means that next effect compilation will have to be done completely even if a similar effect was already compiled\r\n     */\r\n    public releaseEffects() {\r\n        for (const name in this._compiledEffects) {\r\n            const webGPUPipelineContext = this._compiledEffects[name].getPipelineContext() as WebGPUPipelineContext;\r\n            this._deletePipelineContext(webGPUPipelineContext);\r\n        }\r\n\r\n        this._compiledEffects = {};\r\n    }\r\n\r\n    public _deletePipelineContext(pipelineContext: IPipelineContext): void {\r\n        const webgpuPipelineContext = pipelineContext as WebGPUPipelineContext;\r\n        if (webgpuPipelineContext) {\r\n            pipelineContext.dispose();\r\n        }\r\n    }\r\n\r\n    //------------------------------------------------------------------------------\r\n    //                              Textures\r\n    //------------------------------------------------------------------------------\r\n\r\n    /**\r\n     * Gets a boolean indicating that only power of 2 textures are supported\r\n     * Please note that you can still use non power of 2 textures but in this case the engine will forcefully convert them\r\n     */\r\n    public get needPOTTextures(): boolean {\r\n        return false;\r\n    }\r\n\r\n    /** @hidden */\r\n    public _createHardwareTexture(): HardwareTextureWrapper {\r\n        return new WebGPUHardwareTexture();\r\n    }\r\n\r\n    /**\r\n     * @param texture\r\n     * @hidden\r\n     */\r\n    public _releaseTexture(texture: InternalTexture): void {\r\n        const index = this._internalTexturesCache.indexOf(texture);\r\n        if (index !== -1) {\r\n            this._internalTexturesCache.splice(index, 1);\r\n        }\r\n\r\n        this._textureHelper.releaseTexture(texture);\r\n    }\r\n\r\n    /**\r\n     * @hidden\r\n     */\r\n    public _getRGBABufferInternalSizedFormat(): number {\r\n        return Constants.TEXTUREFORMAT_RGBA;\r\n    }\r\n\r\n    public updateTextureComparisonFunction(texture: InternalTexture, comparisonFunction: number): void {\r\n        texture._comparisonFunction = comparisonFunction;\r\n    }\r\n\r\n    /**\r\n     * Creates an internal texture without binding it to a framebuffer\r\n     * @hidden\r\n     * @param size defines the size of the texture\r\n     * @param options defines the options used to create the texture\r\n     * @param delayGPUTextureCreation true to delay the texture creation the first time it is really needed. false to create it right away\r\n     * @param source source type of the texture\r\n     * @returns a new internal texture\r\n     */\r\n    public _createInternalTexture(\r\n        size: TextureSize,\r\n        options: boolean | InternalTextureCreationOptions,\r\n        delayGPUTextureCreation = true,\r\n        source = InternalTextureSource.Unknown\r\n    ): InternalTexture {\r\n        const fullOptions: InternalTextureCreationOptions = {};\r\n\r\n        if (options !== undefined && typeof options === \"object\") {\r\n            fullOptions.generateMipMaps = options.generateMipMaps;\r\n            fullOptions.type = options.type === undefined ? Constants.TEXTURETYPE_UNSIGNED_INT : options.type;\r\n            fullOptions.samplingMode = options.samplingMode === undefined ? Constants.TEXTURE_TRILINEAR_SAMPLINGMODE : options.samplingMode;\r\n            fullOptions.format = options.format === undefined ? Constants.TEXTUREFORMAT_RGBA : options.format;\r\n            fullOptions.samples = options.samples ?? 1;\r\n            fullOptions.creationFlags = options.creationFlags ?? 0;\r\n        } else {\r\n            fullOptions.generateMipMaps = <boolean>options;\r\n            fullOptions.type = Constants.TEXTURETYPE_UNSIGNED_INT;\r\n            fullOptions.samplingMode = Constants.TEXTURE_TRILINEAR_SAMPLINGMODE;\r\n            fullOptions.format = Constants.TEXTUREFORMAT_RGBA;\r\n            fullOptions.samples = 1;\r\n            fullOptions.creationFlags = 0;\r\n        }\r\n\r\n        if (fullOptions.type === Constants.TEXTURETYPE_FLOAT && !this._caps.textureFloatLinearFiltering) {\r\n            fullOptions.samplingMode = Constants.TEXTURE_NEAREST_SAMPLINGMODE;\r\n        } else if (fullOptions.type === Constants.TEXTURETYPE_HALF_FLOAT && !this._caps.textureHalfFloatLinearFiltering) {\r\n            fullOptions.samplingMode = Constants.TEXTURE_NEAREST_SAMPLINGMODE;\r\n        }\r\n        if (fullOptions.type === Constants.TEXTURETYPE_FLOAT && !this._caps.textureFloat) {\r\n            fullOptions.type = Constants.TEXTURETYPE_UNSIGNED_INT;\r\n            Logger.Warn(\"Float textures are not supported. Type forced to TEXTURETYPE_UNSIGNED_BYTE\");\r\n        }\r\n\r\n        const texture = new InternalTexture(this, source);\r\n\r\n        const width = (<{ width: number; height: number; layers?: number }>size).width || <number>size;\r\n        const height = (<{ width: number; height: number; layers?: number }>size).height || <number>size;\r\n        const layers = (<{ width: number; height: number; layers?: number }>size).layers || 0;\r\n\r\n        texture.baseWidth = width;\r\n        texture.baseHeight = height;\r\n        texture.width = width;\r\n        texture.height = height;\r\n        texture.depth = layers;\r\n        texture.isReady = true;\r\n        texture.samples = fullOptions.samples;\r\n        texture.generateMipMaps = fullOptions.generateMipMaps ? true : false;\r\n        texture.samplingMode = fullOptions.samplingMode;\r\n        texture.type = fullOptions.type;\r\n        texture.format = fullOptions.format;\r\n        texture.is2DArray = layers > 0;\r\n        texture._cachedWrapU = Constants.TEXTURE_CLAMP_ADDRESSMODE;\r\n        texture._cachedWrapV = Constants.TEXTURE_CLAMP_ADDRESSMODE;\r\n\r\n        this._internalTexturesCache.push(texture);\r\n\r\n        if (!delayGPUTextureCreation) {\r\n            this._textureHelper.createGPUTextureForInternalTexture(texture, width, height, layers || 1, fullOptions.creationFlags);\r\n        }\r\n\r\n        return texture;\r\n    }\r\n\r\n    /**\r\n     * Usually called from Texture.ts.\r\n     * Passed information to create a hardware texture\r\n     * @param url defines a value which contains one of the following:\r\n     * * A conventional http URL, e.g. 'http://...' or 'file://...'\r\n     * * A base64 string of in-line texture data, e.g. 'data:image/jpg;base64,/...'\r\n     * * An indicator that data being passed using the buffer parameter, e.g. 'data:mytexture.jpg'\r\n     * @param noMipmap defines a boolean indicating that no mipmaps shall be generated.  Ignored for compressed textures.  They must be in the file\r\n     * @param invertY when true, image is flipped when loaded.  You probably want true. Certain compressed textures may invert this if their default is inverted (eg. ktx)\r\n     * @param scene needed for loading to the correct scene\r\n     * @param samplingMode mode with should be used sample / access the texture (Default: Texture.TRILINEAR_SAMPLINGMODE)\r\n     * @param onLoad optional callback to be called upon successful completion\r\n     * @param onError optional callback to be called upon failure\r\n     * @param buffer a source of a file previously fetched as either a base64 string, an ArrayBuffer (compressed or image format), HTMLImageElement (image format), or a Blob\r\n     * @param fallback an internal argument in case the function must be called again, due to etc1 not having alpha capabilities\r\n     * @param format internal format.  Default: RGB when extension is '.jpg' else RGBA.  Ignored for compressed textures\r\n     * @param forcedExtension defines the extension to use to pick the right loader\r\n     * @param mimeType defines an optional mime type\r\n     * @param loaderOptions options to be passed to the loader\r\n     * @param creationFlags specific flags to use when creating the texture (Constants.TEXTURE_CREATIONFLAG_STORAGE for storage textures, for eg)\r\n     * @param useSRGBBuffer defines if the texture must be loaded in a sRGB GPU buffer (if supported by the GPU).\r\n     * @returns a InternalTexture for assignment back into BABYLON.Texture\r\n     */\r\n    public createTexture(\r\n        url: Nullable<string>,\r\n        noMipmap: boolean,\r\n        invertY: boolean,\r\n        scene: Nullable<ISceneLike>,\r\n        samplingMode: number = Constants.TEXTURE_TRILINEAR_SAMPLINGMODE,\r\n        onLoad: Nullable<() => void> = null,\r\n        onError: Nullable<(message: string, exception: any) => void> = null,\r\n        buffer: Nullable<string | ArrayBuffer | ArrayBufferView | HTMLImageElement | Blob | ImageBitmap> = null,\r\n        fallback: Nullable<InternalTexture> = null,\r\n        format: Nullable<number> = null,\r\n        forcedExtension: Nullable<string> = null,\r\n        mimeType?: string,\r\n        loaderOptions?: any,\r\n        creationFlags?: number,\r\n        useSRGBBuffer?: boolean\r\n    ): InternalTexture {\r\n        return this._createTextureBase(\r\n            url,\r\n            noMipmap,\r\n            invertY,\r\n            scene,\r\n            samplingMode,\r\n            onLoad,\r\n            onError,\r\n            (\r\n                texture: InternalTexture,\r\n                extension: string,\r\n                scene: Nullable<ISceneLike>,\r\n                img: HTMLImageElement | ImageBitmap | { width: number; height: number },\r\n                invertY: boolean,\r\n                noMipmap: boolean,\r\n                isCompressed: boolean,\r\n                processFunction: (\r\n                    width: number,\r\n                    height: number,\r\n                    img: HTMLImageElement | ImageBitmap | { width: number; height: number },\r\n                    extension: string,\r\n                    texture: InternalTexture,\r\n                    continuationCallback: () => void\r\n                ) => boolean\r\n            ) => {\r\n                const imageBitmap = img as ImageBitmap | { width: number; height: number }; // we will never get an HTMLImageElement in WebGPU\r\n\r\n                texture.baseWidth = imageBitmap.width;\r\n                texture.baseHeight = imageBitmap.height;\r\n                texture.width = imageBitmap.width;\r\n                texture.height = imageBitmap.height;\r\n                texture.format = format ?? -1;\r\n\r\n                processFunction(texture.width, texture.height, imageBitmap, extension, texture, () => {});\r\n\r\n                if (!texture._hardwareTexture?.underlyingResource) {\r\n                    // the texture could have been created before reaching this point so don't recreate it if already existing\r\n                    const gpuTextureWrapper = this._textureHelper.createGPUTextureForInternalTexture(texture, imageBitmap.width, imageBitmap.height, undefined, creationFlags);\r\n\r\n                    if (WebGPUTextureHelper.IsImageBitmap(imageBitmap)) {\r\n                        this._textureHelper.updateTexture(\r\n                            imageBitmap,\r\n                            texture,\r\n                            imageBitmap.width,\r\n                            imageBitmap.height,\r\n                            texture.depth,\r\n                            gpuTextureWrapper.format,\r\n                            0,\r\n                            0,\r\n                            invertY,\r\n                            false,\r\n                            0,\r\n                            0\r\n                        );\r\n                        if (!noMipmap && !isCompressed) {\r\n                            this._generateMipmaps(texture, this._uploadEncoder);\r\n                        }\r\n                    }\r\n                } else if (!noMipmap && !isCompressed) {\r\n                    this._generateMipmaps(texture, this._uploadEncoder);\r\n                }\r\n\r\n                if (scene) {\r\n                    scene._removePendingData(texture);\r\n                }\r\n\r\n                texture.isReady = true;\r\n\r\n                texture.onLoadedObservable.notifyObservers(texture);\r\n                texture.onLoadedObservable.clear();\r\n            },\r\n            () => false,\r\n            buffer,\r\n            fallback,\r\n            format,\r\n            forcedExtension,\r\n            mimeType,\r\n            loaderOptions,\r\n            useSRGBBuffer\r\n        );\r\n    }\r\n\r\n    /**\r\n     * Wraps an external web gpu texture in a Babylon texture.\r\n     * @param texture defines the external texture\r\n     * @returns the babylon internal texture\r\n     */\r\n    wrapWebGPUTexture(texture: GPUTexture): InternalTexture {\r\n        const hardwareTexture = new WebGPUHardwareTexture(texture);\r\n        const internalTexture = new InternalTexture(this, InternalTextureSource.Unknown, true);\r\n        internalTexture._hardwareTexture = hardwareTexture;\r\n        internalTexture.isReady = true;\r\n        return internalTexture;\r\n    }\r\n\r\n    /**\r\n     * Wraps an external web gl texture in a Babylon texture.\r\n     * @returns the babylon internal texture\r\n     */\r\n    wrapWebGLTexture(): InternalTexture {\r\n        throw new Error(\"wrapWebGLTexture is not supported, use wrapWebGPUTexture instead.\");\r\n    }\r\n\r\n    public generateMipMapsForCubemap(texture: InternalTexture) {\r\n        if (texture.generateMipMaps) {\r\n            const gpuTexture = texture._hardwareTexture?.underlyingResource;\r\n\r\n            if (!gpuTexture) {\r\n                this._textureHelper.createGPUTextureForInternalTexture(texture);\r\n            }\r\n\r\n            this._generateMipmaps(\r\n                texture,\r\n                texture.source === InternalTextureSource.RenderTarget || texture.source === InternalTextureSource.MultiRenderTarget ? this._renderTargetEncoder : undefined\r\n            );\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Update the sampling mode of a given texture\r\n     * @param samplingMode defines the required sampling mode\r\n     * @param texture defines the texture to update\r\n     * @param generateMipMaps defines whether to generate mipmaps for the texture\r\n     */\r\n    public updateTextureSamplingMode(samplingMode: number, texture: InternalTexture, generateMipMaps: boolean = false): void {\r\n        if (generateMipMaps) {\r\n            texture.generateMipMaps = true;\r\n            this._generateMipmaps(texture);\r\n        }\r\n\r\n        texture.samplingMode = samplingMode;\r\n    }\r\n\r\n    /**\r\n     * Update the sampling mode of a given texture\r\n     * @param texture defines the texture to update\r\n     * @param wrapU defines the texture wrap mode of the u coordinates\r\n     * @param wrapV defines the texture wrap mode of the v coordinates\r\n     * @param wrapR defines the texture wrap mode of the r coordinates\r\n     */\r\n    public updateTextureWrappingMode(texture: InternalTexture, wrapU: Nullable<number>, wrapV: Nullable<number> = null, wrapR: Nullable<number> = null): void {\r\n        if (wrapU !== null) {\r\n            texture._cachedWrapU = wrapU;\r\n        }\r\n        if (wrapV !== null) {\r\n            texture._cachedWrapV = wrapV;\r\n        }\r\n        if ((texture.is2DArray || texture.is3D) && wrapR !== null) {\r\n            texture._cachedWrapR = wrapR;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Update the dimensions of a texture\r\n     * @param texture texture to update\r\n     * @param width new width of the texture\r\n     * @param height new height of the texture\r\n     * @param depth new depth of the texture\r\n     */\r\n    public updateTextureDimensions(texture: InternalTexture, width: number, height: number, depth: number = 1): void {\r\n        if (!texture._hardwareTexture) {\r\n            // the gpu texture is not created yet, so when it is it will be created with the right dimensions\r\n            return;\r\n        }\r\n\r\n        if (texture.width === width && texture.height === height && texture.depth === depth) {\r\n            return;\r\n        }\r\n\r\n        const additionalUsages = (texture._hardwareTexture as WebGPUHardwareTexture).textureAdditionalUsages;\r\n\r\n        texture._hardwareTexture.release(); // don't defer the releasing! Else we will release at the end of this frame the gpu texture we are about to create in the next line...\r\n\r\n        this._textureHelper.createGPUTextureForInternalTexture(texture, width, height, depth, additionalUsages);\r\n    }\r\n\r\n    /**\r\n     * @param name\r\n     * @param texture\r\n     * @param baseName\r\n     * @hidden\r\n     */\r\n    public _setInternalTexture(name: string, texture: Nullable<InternalTexture | ExternalTexture>, baseName?: string): void {\r\n        baseName = baseName ?? name;\r\n        if (this._currentEffect) {\r\n            const webgpuPipelineContext = this._currentEffect._pipelineContext as WebGPUPipelineContext;\r\n            const availableTexture = webgpuPipelineContext.shaderProcessingContext.availableTextures[baseName];\r\n\r\n            this._currentMaterialContext.setTexture(name, texture);\r\n\r\n            if (availableTexture && availableTexture.autoBindSampler) {\r\n                const samplerName = baseName + WebGPUShaderProcessor.AutoSamplerSuffix;\r\n                this._currentMaterialContext.setSampler(samplerName, texture as InternalTexture); // we can safely cast to InternalTexture because ExternalTexture always has autoBindSampler = false\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Sets a texture to the according uniform.\r\n     * @param channel The texture channel\r\n     * @param unused unused parameter\r\n     * @param texture The texture to apply\r\n     * @param name The name of the uniform in the effect\r\n     */\r\n    public setTexture(channel: number, unused: Nullable<WebGLUniformLocation>, texture: Nullable<BaseTexture>, name: string): void {\r\n        this._setTexture(channel, texture, false, false, name, name);\r\n    }\r\n\r\n    /**\r\n     * Sets an array of texture to the WebGPU context\r\n     * @param channel defines the channel where the texture array must be set\r\n     * @param unused unused parameter\r\n     * @param textures defines the array of textures to bind\r\n     * @param name name of the channel\r\n     */\r\n    public setTextureArray(channel: number, unused: Nullable<WebGLUniformLocation>, textures: BaseTexture[], name: string): void {\r\n        for (let index = 0; index < textures.length; index++) {\r\n            this._setTexture(-1, textures[index], true, false, name + index.toString(), name);\r\n        }\r\n    }\r\n\r\n    protected _setTexture(\r\n        channel: number,\r\n        texture: Nullable<BaseTexture>,\r\n        // eslint-disable-next-line @typescript-eslint/no-unused-vars\r\n        isPartOfTextureArray = false,\r\n        depthStencilTexture = false,\r\n        name = \"\",\r\n        baseName?: string\r\n    ): boolean {\r\n        // name == baseName for a texture that is not part of a texture array\r\n        // Else, name is something like 'myTexture0' / 'myTexture1' / ... and baseName is 'myTexture'\r\n        // baseName is used to look up the texture in the shaderProcessingContext.availableTextures map\r\n        // name is used to look up the texture in the _currentMaterialContext.textures map\r\n        baseName = baseName ?? name;\r\n        if (this._currentEffect) {\r\n            if (!texture) {\r\n                this._currentMaterialContext.setTexture(name, null);\r\n                return false;\r\n            }\r\n\r\n            // Video\r\n            if ((<VideoTexture>texture).video) {\r\n                (<VideoTexture>texture).update();\r\n            } else if (texture.delayLoadState === Constants.DELAYLOADSTATE_NOTLOADED) {\r\n                // Delay loading\r\n                texture.delayLoad();\r\n                return false;\r\n            }\r\n\r\n            let internalTexture: Nullable<InternalTexture> = null;\r\n            if (depthStencilTexture) {\r\n                internalTexture = (<RenderTargetTexture>texture).depthStencilTexture!;\r\n            } else if (texture.isReady()) {\r\n                internalTexture = <InternalTexture>texture.getInternalTexture();\r\n            } else if (texture.isCube) {\r\n                internalTexture = this.emptyCubeTexture;\r\n            } else if (texture.is3D) {\r\n                internalTexture = this.emptyTexture3D;\r\n            } else if (texture.is2DArray) {\r\n                internalTexture = this.emptyTexture2DArray;\r\n            } else {\r\n                internalTexture = this.emptyTexture;\r\n            }\r\n\r\n            if (internalTexture && !internalTexture.isMultiview) {\r\n                // CUBIC_MODE and SKYBOX_MODE both require CLAMP_TO_EDGE.  All other modes use REPEAT.\r\n                if (internalTexture.isCube && internalTexture._cachedCoordinatesMode !== texture.coordinatesMode) {\r\n                    internalTexture._cachedCoordinatesMode = texture.coordinatesMode;\r\n\r\n                    const textureWrapMode =\r\n                        texture.coordinatesMode !== Constants.TEXTURE_CUBIC_MODE && texture.coordinatesMode !== Constants.TEXTURE_SKYBOX_MODE\r\n                            ? Constants.TEXTURE_WRAP_ADDRESSMODE\r\n                            : Constants.TEXTURE_CLAMP_ADDRESSMODE;\r\n                    texture.wrapU = textureWrapMode;\r\n                    texture.wrapV = textureWrapMode;\r\n                }\r\n\r\n                internalTexture._cachedWrapU = texture.wrapU;\r\n                internalTexture._cachedWrapV = texture.wrapV;\r\n                if (internalTexture.is3D) {\r\n                    internalTexture._cachedWrapR = texture.wrapR;\r\n                }\r\n\r\n                this._setAnisotropicLevel(0, internalTexture, texture.anisotropicFilteringLevel);\r\n            }\r\n\r\n            this._setInternalTexture(name, internalTexture, baseName);\r\n        } else {\r\n            if (this.dbgVerboseLogsForFirstFrames) {\r\n                if ((this as any)._count === undefined) {\r\n                    (this as any)._count = 0;\r\n                }\r\n                if (!(this as any)._count || (this as any)._count < this.dbgVerboseLogsNumFrames) {\r\n                    console.log(\"frame #\" + (this as any)._count + \" - _setTexture called with a null _currentEffect! texture=\", texture);\r\n                }\r\n            }\r\n        }\r\n\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * @param target\r\n     * @param internalTexture\r\n     * @param anisotropicFilteringLevel\r\n     * @hidden\r\n     */\r\n    public _setAnisotropicLevel(target: number, internalTexture: InternalTexture, anisotropicFilteringLevel: number) {\r\n        if (internalTexture._cachedAnisotropicFilteringLevel !== anisotropicFilteringLevel) {\r\n            internalTexture._cachedAnisotropicFilteringLevel = Math.min(anisotropicFilteringLevel, this._caps.maxAnisotropy);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @param channel\r\n     * @param texture\r\n     * @param name\r\n     * @hidden\r\n     */\r\n    public _bindTexture(channel: number, texture: InternalTexture, name: string): void {\r\n        if (channel === undefined) {\r\n            return;\r\n        }\r\n\r\n        this._setInternalTexture(name, texture);\r\n    }\r\n\r\n    /**\r\n     * Generates the mipmaps for a texture\r\n     * @param texture texture to generate the mipmaps for\r\n     */\r\n    public generateMipmaps(texture: InternalTexture): void {\r\n        this._generateMipmaps(texture, this._renderTargetEncoder);\r\n    }\r\n\r\n    /**\r\n     * @param texture\r\n     * @param commandEncoder\r\n     * @hidden\r\n     */\r\n    public _generateMipmaps(texture: InternalTexture, commandEncoder?: GPUCommandEncoder) {\r\n        const gpuHardwareTexture = texture._hardwareTexture as Nullable<WebGPUHardwareTexture>;\r\n\r\n        if (!gpuHardwareTexture) {\r\n            return;\r\n        }\r\n\r\n        // try as much as possible to use the command encoder corresponding to the current pass.\r\n        // If not possible (because the pass is started - generateMipmaps itself creates a pass and it's not allowed to have a pass inside a pass), use _uploadEncoder\r\n        commandEncoder =\r\n            commandEncoder ??\r\n            (this._currentRenderTarget && !this._currentRenderPass ? this._renderTargetEncoder : !this._currentRenderPass ? this._renderEncoder : this._uploadEncoder);\r\n\r\n        const format = (texture._hardwareTexture as WebGPUHardwareTexture).format;\r\n        const mipmapCount = WebGPUTextureHelper.ComputeNumMipmapLevels(texture.width, texture.height);\r\n\r\n        if (this.dbgVerboseLogsForFirstFrames) {\r\n            if ((this as any)._count === undefined) {\r\n                (this as any)._count = 0;\r\n            }\r\n            if (!(this as any)._count || (this as any)._count < this.dbgVerboseLogsNumFrames) {\r\n                console.log(\"frame #\" + (this as any)._count + \" - generate mipmaps called - width=\", texture.width, \"height=\", texture.height, \"isCube=\", texture.isCube);\r\n            }\r\n        }\r\n\r\n        if (texture.isCube) {\r\n            this._textureHelper.generateCubeMipmaps(gpuHardwareTexture, format, mipmapCount, commandEncoder);\r\n        } else {\r\n            this._textureHelper.generateMipmaps(gpuHardwareTexture, format, mipmapCount, 0, commandEncoder);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Update a portion of an internal texture\r\n     * @param texture defines the texture to update\r\n     * @param imageData defines the data to store into the texture\r\n     * @param xOffset defines the x coordinates of the update rectangle\r\n     * @param yOffset defines the y coordinates of the update rectangle\r\n     * @param width defines the width of the update rectangle\r\n     * @param height defines the height of the update rectangle\r\n     * @param faceIndex defines the face index if texture is a cube (0 by default)\r\n     * @param lod defines the lod level to update (0 by default)\r\n     * @param generateMipMaps defines whether to generate mipmaps or not\r\n     */\r\n    public updateTextureData(\r\n        texture: InternalTexture,\r\n        imageData: ArrayBufferView,\r\n        xOffset: number,\r\n        yOffset: number,\r\n        width: number,\r\n        height: number,\r\n        faceIndex: number = 0,\r\n        lod: number = 0,\r\n        generateMipMaps = false\r\n    ): void {\r\n        let gpuTextureWrapper = texture._hardwareTexture as WebGPUHardwareTexture;\r\n\r\n        if (!texture._hardwareTexture?.underlyingResource) {\r\n            gpuTextureWrapper = this._textureHelper.createGPUTextureForInternalTexture(texture);\r\n        }\r\n\r\n        const data = new Uint8Array(imageData.buffer, imageData.byteOffset, imageData.byteLength);\r\n\r\n        this._textureHelper.updateTexture(data, texture, width, height, texture.depth, gpuTextureWrapper.format, faceIndex, lod, texture.invertY, false, xOffset, yOffset);\r\n\r\n        if (generateMipMaps) {\r\n            this._generateMipmaps(texture, this._renderTargetEncoder);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @param texture\r\n     * @param internalFormat\r\n     * @param width\r\n     * @param height\r\n     * @param imageData\r\n     * @param faceIndex\r\n     * @param lod\r\n     * @hidden\r\n     */\r\n    public _uploadCompressedDataToTextureDirectly(\r\n        texture: InternalTexture,\r\n        internalFormat: number,\r\n        width: number,\r\n        height: number,\r\n        imageData: ArrayBufferView,\r\n        faceIndex: number = 0,\r\n        lod: number = 0\r\n    ) {\r\n        let gpuTextureWrapper = texture._hardwareTexture as WebGPUHardwareTexture;\r\n\r\n        if (!texture._hardwareTexture?.underlyingResource) {\r\n            texture.format = internalFormat;\r\n            gpuTextureWrapper = this._textureHelper.createGPUTextureForInternalTexture(texture, width, height);\r\n        }\r\n\r\n        const data = new Uint8Array(imageData.buffer, imageData.byteOffset, imageData.byteLength);\r\n\r\n        this._textureHelper.updateTexture(data, texture, width, height, texture.depth, gpuTextureWrapper.format, faceIndex, lod, false, false, 0, 0);\r\n    }\r\n\r\n    /**\r\n     * @param texture\r\n     * @param imageData\r\n     * @param faceIndex\r\n     * @param lod\r\n     * @param babylonInternalFormat\r\n     * @param useTextureWidthAndHeight\r\n     * @hidden\r\n     */\r\n    public _uploadDataToTextureDirectly(\r\n        texture: InternalTexture,\r\n        imageData: ArrayBufferView,\r\n        faceIndex: number = 0,\r\n        lod: number = 0,\r\n        babylonInternalFormat?: number,\r\n        useTextureWidthAndHeight = false\r\n    ): void {\r\n        const lodMaxWidth = Math.round(Math.log(texture.width) * Math.LOG2E);\r\n        const lodMaxHeight = Math.round(Math.log(texture.height) * Math.LOG2E);\r\n\r\n        const width = useTextureWidthAndHeight ? texture.width : Math.pow(2, Math.max(lodMaxWidth - lod, 0));\r\n        const height = useTextureWidthAndHeight ? texture.height : Math.pow(2, Math.max(lodMaxHeight - lod, 0));\r\n\r\n        let gpuTextureWrapper = texture._hardwareTexture as WebGPUHardwareTexture;\r\n\r\n        if (!texture._hardwareTexture?.underlyingResource) {\r\n            gpuTextureWrapper = this._textureHelper.createGPUTextureForInternalTexture(texture, width, height);\r\n        }\r\n\r\n        const data = new Uint8Array(imageData.buffer, imageData.byteOffset, imageData.byteLength);\r\n\r\n        this._textureHelper.updateTexture(data, texture, width, height, texture.depth, gpuTextureWrapper.format, faceIndex, lod, texture.invertY, false, 0, 0);\r\n    }\r\n\r\n    /**\r\n     * @param texture\r\n     * @param imageData\r\n     * @param faceIndex\r\n     * @param lod\r\n     * @hidden\r\n     */\r\n    public _uploadArrayBufferViewToTexture(texture: InternalTexture, imageData: ArrayBufferView, faceIndex: number = 0, lod: number = 0): void {\r\n        this._uploadDataToTextureDirectly(texture, imageData, faceIndex, lod);\r\n    }\r\n\r\n    /**\r\n     * @param texture\r\n     * @param image\r\n     * @param faceIndex\r\n     * @param lod\r\n     * @hidden\r\n     */\r\n    public _uploadImageToTexture(texture: InternalTexture, image: HTMLImageElement | ImageBitmap, faceIndex: number = 0, lod: number = 0) {\r\n        let gpuTextureWrapper = texture._hardwareTexture as WebGPUHardwareTexture;\r\n\r\n        if (!texture._hardwareTexture?.underlyingResource) {\r\n            gpuTextureWrapper = this._textureHelper.createGPUTextureForInternalTexture(texture);\r\n        }\r\n\r\n        const bitmap = image as ImageBitmap; // in WebGPU we will always get an ImageBitmap, not an HTMLImageElement\r\n\r\n        const width = Math.ceil(texture.width / (1 << lod));\r\n        const height = Math.ceil(texture.height / (1 << lod));\r\n\r\n        this._textureHelper.updateTexture(bitmap, texture, width, height, texture.depth, gpuTextureWrapper.format, faceIndex, lod, texture.invertY, false, 0, 0);\r\n    }\r\n\r\n    /**\r\n     * Reads pixels from the current frame buffer. Please note that this function can be slow\r\n     * @param x defines the x coordinate of the rectangle where pixels must be read\r\n     * @param y defines the y coordinate of the rectangle where pixels must be read\r\n     * @param width defines the width of the rectangle where pixels must be read\r\n     * @param height defines the height of the rectangle where pixels must be read\r\n     * @param hasAlpha defines whether the output should have alpha or not (defaults to true)\r\n     * @param flushRenderer true to flush the renderer from the pending commands before reading the pixels\r\n     * @returns a ArrayBufferView promise (Uint8Array) containing RGBA colors\r\n     */\r\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\r\n    public readPixels(x: number, y: number, width: number, height: number, hasAlpha = true, flushRenderer = true): Promise<ArrayBufferView> {\r\n        const renderPassWrapper = this._rttRenderPassWrapper.renderPass ? this._rttRenderPassWrapper : this._mainRenderPassWrapper;\r\n        const hardwareTexture = renderPassWrapper.colorAttachmentGPUTextures[0];\r\n        if (!hardwareTexture) {\r\n            // we are calling readPixels for a render pass with no color texture bound\r\n            return Promise.resolve(new Uint8Array(0));\r\n        }\r\n        const gpuTexture = hardwareTexture.underlyingResource;\r\n        const gpuTextureFormat = hardwareTexture.format;\r\n        if (!gpuTexture) {\r\n            // we are calling readPixels before startMainRenderPass has been called and no RTT is bound, so swapChainTexture is not setup yet!\r\n            return Promise.resolve(new Uint8Array(0));\r\n        }\r\n        if (flushRenderer) {\r\n            this.flushFramebuffer();\r\n        }\r\n        return this._textureHelper.readPixels(gpuTexture, x, y, width, height, gpuTextureFormat);\r\n    }\r\n\r\n    //------------------------------------------------------------------------------\r\n    //                              Frame management\r\n    //------------------------------------------------------------------------------\r\n\r\n    /**\r\n     * Begin a new frame\r\n     */\r\n    public beginFrame(): void {\r\n        super.beginFrame();\r\n    }\r\n\r\n    /**\r\n     * End the current frame\r\n     */\r\n    public endFrame() {\r\n        this._snapshotRendering.endFrame(this._mainRenderPassWrapper.renderPass);\r\n\r\n        this._endMainRenderPass();\r\n\r\n        this._timestampQuery.endFrame(this._renderEncoder);\r\n\r\n        this.flushFramebuffer(false);\r\n\r\n        if (this.dbgVerboseLogsForFirstFrames) {\r\n            if ((this as any)._count === undefined) {\r\n                (this as any)._count = 0;\r\n            }\r\n            if (!(this as any)._count || (this as any)._count < this.dbgVerboseLogsNumFrames) {\r\n                console.log(\"frame #\" + (this as any)._count + \" - counters\");\r\n            }\r\n        }\r\n\r\n        this._textureHelper.destroyDeferredTextures();\r\n        this._bufferManager.destroyDeferredBuffers();\r\n\r\n        if (this._features._collectUbosUpdatedInFrame) {\r\n            if (this.dbgVerboseLogsForFirstFrames) {\r\n                if ((this as any)._count === undefined) {\r\n                    (this as any)._count = 0;\r\n                }\r\n                if (!(this as any)._count || (this as any)._count < this.dbgVerboseLogsNumFrames) {\r\n                    const list: Array<string> = [];\r\n                    for (const name in UniformBuffer._UpdatedUbosInFrame) {\r\n                        list.push(name + \":\" + UniformBuffer._UpdatedUbosInFrame[name]);\r\n                    }\r\n                    console.log(\"frame #\" + (this as any)._count + \" - updated ubos -\", list.join(\", \"));\r\n                }\r\n            }\r\n            UniformBuffer._UpdatedUbosInFrame = {};\r\n        }\r\n\r\n        this.countersLastFrame.numEnableEffects = this._counters.numEnableEffects;\r\n        this.countersLastFrame.numEnableDrawWrapper = this._counters.numEnableDrawWrapper;\r\n        this.countersLastFrame.numBundleCreationNonCompatMode = this._counters.numBundleCreationNonCompatMode;\r\n        this.countersLastFrame.numBundleReuseNonCompatMode = this._counters.numBundleReuseNonCompatMode;\r\n        this._counters.numEnableEffects = 0;\r\n        this._counters.numEnableDrawWrapper = 0;\r\n        this._counters.numBundleCreationNonCompatMode = 0;\r\n        this._counters.numBundleReuseNonCompatMode = 0;\r\n\r\n        this._cacheRenderPipeline.endFrame();\r\n        this._cacheBindGroups.endFrame();\r\n\r\n        this._pendingDebugCommands.length = 0;\r\n\r\n        super.endFrame();\r\n\r\n        if (this.dbgVerboseLogsForFirstFrames) {\r\n            if ((this as any)._count === undefined) {\r\n                (this as any)._count = 0;\r\n            }\r\n            if ((this as any)._count < this.dbgVerboseLogsNumFrames) {\r\n                console.log(\"%c frame #\" + (this as any)._count + \" - end\", \"background: #ffff00\");\r\n            }\r\n            if ((this as any)._count < this.dbgVerboseLogsNumFrames) {\r\n                (this as any)._count++;\r\n                if ((this as any)._count !== this.dbgVerboseLogsNumFrames) {\r\n                    console.log(\"%c frame #\" + (this as any)._count + \" - begin\", \"background: #ffff00\");\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Force a WebGPU flush (ie. a flush of all waiting commands)\r\n     * @param reopenPass true to reopen at the end of the function the pass that was active when entering the function\r\n     */\r\n    public flushFramebuffer(reopenPass = true): void {\r\n        // we need to end the current render pass (main or rtt) if any as we are not allowed to submit the command buffers when being in a pass\r\n        const currentRenderPassIsNULL = !this._currentRenderPass;\r\n        let currentPasses = 0; // 0 if no pass, 1 for rtt, 2 for main pass\r\n        if (this._currentRenderPass && this._currentRenderTarget) {\r\n            currentPasses |= 1;\r\n            this._endRenderTargetRenderPass();\r\n        }\r\n        if (this._mainRenderPassWrapper.renderPass) {\r\n            currentPasses |= 2;\r\n            this._endMainRenderPass();\r\n        }\r\n\r\n        this._commandBuffers[0] = this._uploadEncoder.finish();\r\n        this._commandBuffers[1] = this._renderTargetEncoder.finish();\r\n        this._commandBuffers[2] = this._renderEncoder.finish();\r\n\r\n        this._device.queue.submit(this._commandBuffers);\r\n\r\n        this._uploadEncoder = this._device.createCommandEncoder(this._uploadEncoderDescriptor);\r\n        this._renderEncoder = this._device.createCommandEncoder(this._renderEncoderDescriptor);\r\n        this._renderTargetEncoder = this._device.createCommandEncoder(this._renderTargetEncoderDescriptor);\r\n\r\n        this._timestampQuery.startFrame(this._uploadEncoder);\r\n\r\n        this._textureHelper.setCommandEncoder(this._uploadEncoder);\r\n\r\n        this._bundleList.reset();\r\n        this._bundleListRenderTarget.reset();\r\n\r\n        // restart the render pass\r\n        if (reopenPass) {\r\n            if (currentPasses & 2) {\r\n                this._startMainRenderPass(false);\r\n            }\r\n            if (currentPasses & 1) {\r\n                this._startRenderTargetRenderPass(this._currentRenderTarget!, false, null, false, false);\r\n            }\r\n            if (currentRenderPassIsNULL && this._currentRenderTarget) {\r\n                this._currentRenderPass = null;\r\n            }\r\n        }\r\n    }\r\n\r\n    /** @hidden */\r\n    public _currentFrameBufferIsDefaultFrameBuffer() {\r\n        return this._currentRenderTarget === null;\r\n    }\r\n\r\n    //------------------------------------------------------------------------------\r\n    //                              Render Pass\r\n    //------------------------------------------------------------------------------\r\n\r\n    private _startRenderTargetRenderPass(\r\n        renderTargetWrapper: RenderTargetWrapper,\r\n        setClearStates: boolean,\r\n        clearColor: Nullable<IColor4Like>,\r\n        clearDepth: boolean,\r\n        clearStencil: boolean\r\n    ) {\r\n        const rtWrapper = renderTargetWrapper as WebGPURenderTargetWrapper;\r\n\r\n        const depthStencilTexture = rtWrapper._depthStencilTexture;\r\n        const gpuDepthStencilWrapper = depthStencilTexture?._hardwareTexture as Nullable<WebGPUHardwareTexture>;\r\n        const gpuDepthStencilTexture = gpuDepthStencilWrapper?.underlyingResource as Nullable<GPUTexture>;\r\n        const gpuDepthStencilMSAATexture = gpuDepthStencilWrapper?.msaaTexture;\r\n\r\n        const depthTextureView = gpuDepthStencilTexture?.createView(this._rttRenderPassWrapper.depthAttachmentViewDescriptor!);\r\n        const depthMSAATextureView = gpuDepthStencilMSAATexture?.createView(this._rttRenderPassWrapper.depthAttachmentViewDescriptor!);\r\n        const depthTextureHasStencil = gpuDepthStencilWrapper ? WebGPUTextureHelper.HasStencilAspect(gpuDepthStencilWrapper.format) : false;\r\n\r\n        const colorAttachments: (GPURenderPassColorAttachment | null)[] = [];\r\n\r\n        if (this.useReverseDepthBuffer) {\r\n            this.setDepthFunctionToGreaterOrEqual();\r\n        }\r\n\r\n        const mustClearColor = setClearStates && clearColor;\r\n        const mustClearDepth = setClearStates && clearDepth;\r\n        const mustClearStencil = setClearStates && clearStencil;\r\n\r\n        if (rtWrapper._attachments && rtWrapper.isMulti) {\r\n            // multi render targets\r\n            if (!this._mrtAttachments || this._mrtAttachments.length === 0) {\r\n                this._mrtAttachments = rtWrapper._defaultAttachments;\r\n            }\r\n            for (let i = 0; i < this._mrtAttachments.length; ++i) {\r\n                const index = this._mrtAttachments[i]; // if index == 0 it means the texture should not be written to => at render pass creation time, it means we should not clear it\r\n                const mrtTexture = rtWrapper.textures![i];\r\n                const gpuMRTWrapper = mrtTexture?._hardwareTexture as Nullable<WebGPUHardwareTexture>;\r\n                const gpuMRTTexture = gpuMRTWrapper?.underlyingResource;\r\n                if (gpuMRTWrapper && gpuMRTTexture) {\r\n                    const viewDescriptor = {\r\n                        ...this._rttRenderPassWrapper.colorAttachmentViewDescriptor!,\r\n                        format: gpuMRTWrapper.format,\r\n                    };\r\n                    const gpuMSAATexture = gpuMRTWrapper.msaaTexture;\r\n                    const colorTextureView = gpuMRTTexture.createView(viewDescriptor);\r\n                    const colorMSAATextureView = gpuMSAATexture?.createView(viewDescriptor);\r\n\r\n                    colorAttachments.push({\r\n                        view: colorMSAATextureView ? colorMSAATextureView : colorTextureView,\r\n                        resolveTarget: gpuMSAATexture ? colorTextureView : undefined,\r\n                        clearValue: index !== 0 && mustClearColor ? clearColor : undefined,\r\n                        loadOp: index !== 0 && mustClearColor ? WebGPUConstants.LoadOp.Clear : WebGPUConstants.LoadOp.Load,\r\n                        storeOp: WebGPUConstants.StoreOp.Store,\r\n                    });\r\n                }\r\n            }\r\n            this._cacheRenderPipeline.setMRT(rtWrapper.textures!, this._mrtAttachments.length);\r\n            this._cacheRenderPipeline.setMRTAttachments(this._mrtAttachments);\r\n        } else {\r\n            // single render target\r\n            const internalTexture = rtWrapper.texture;\r\n            if (internalTexture) {\r\n                const gpuWrapper = internalTexture._hardwareTexture as WebGPUHardwareTexture;\r\n                const gpuTexture = gpuWrapper.underlyingResource!;\r\n\r\n                const gpuMSAATexture = gpuWrapper.msaaTexture;\r\n                const colorTextureView = gpuTexture.createView(this._rttRenderPassWrapper.colorAttachmentViewDescriptor!);\r\n                const colorMSAATextureView = gpuMSAATexture?.createView(this._rttRenderPassWrapper.colorAttachmentViewDescriptor!);\r\n\r\n                colorAttachments.push({\r\n                    view: colorMSAATextureView ? colorMSAATextureView : colorTextureView,\r\n                    resolveTarget: gpuMSAATexture ? colorTextureView : undefined,\r\n                    clearValue: mustClearColor ? clearColor : undefined,\r\n                    loadOp: mustClearColor ? WebGPUConstants.LoadOp.Clear : WebGPUConstants.LoadOp.Load,\r\n                    storeOp: WebGPUConstants.StoreOp.Store,\r\n                });\r\n            } else {\r\n                colorAttachments.push(null);\r\n            }\r\n        }\r\n\r\n        this._debugPushGroup?.(\"render target pass\", 1);\r\n\r\n        this._rttRenderPassWrapper.renderPassDescriptor = {\r\n            colorAttachments,\r\n            depthStencilAttachment:\r\n                depthStencilTexture && gpuDepthStencilTexture\r\n                    ? {\r\n                          view: depthMSAATextureView ? depthMSAATextureView : depthTextureView!,\r\n                          depthClearValue: mustClearDepth ? (this.useReverseDepthBuffer ? this._clearReverseDepthValue : this._clearDepthValue) : undefined,\r\n                          depthLoadOp: mustClearDepth ? WebGPUConstants.LoadOp.Clear : WebGPUConstants.LoadOp.Load,\r\n                          depthStoreOp: WebGPUConstants.StoreOp.Store,\r\n                          stencilClearValue: rtWrapper._depthStencilTextureWithStencil && mustClearStencil ? this._clearStencilValue : undefined,\r\n                          stencilLoadOp: !depthTextureHasStencil\r\n                              ? undefined\r\n                              : rtWrapper._depthStencilTextureWithStencil && mustClearStencil\r\n                              ? WebGPUConstants.LoadOp.Clear\r\n                              : WebGPUConstants.LoadOp.Load,\r\n                          stencilStoreOp: !depthTextureHasStencil ? undefined : WebGPUConstants.StoreOp.Store,\r\n                      }\r\n                    : undefined,\r\n            occlusionQuerySet: this._occlusionQuery?.hasQueries ? this._occlusionQuery.querySet : undefined,\r\n        };\r\n        this._rttRenderPassWrapper.renderPass = this._renderTargetEncoder.beginRenderPass(this._rttRenderPassWrapper.renderPassDescriptor);\r\n\r\n        if (this.dbgVerboseLogsForFirstFrames) {\r\n            if ((this as any)._count === undefined) {\r\n                (this as any)._count = 0;\r\n            }\r\n            if (!(this as any)._count || (this as any)._count < this.dbgVerboseLogsNumFrames) {\r\n                const internalTexture = rtWrapper.texture!;\r\n                console.log(\r\n                    \"frame #\" + (this as any)._count + \" - render target begin pass - internalTexture.uniqueId=\",\r\n                    internalTexture.uniqueId,\r\n                    \"width=\",\r\n                    internalTexture.width,\r\n                    \"height=\",\r\n                    internalTexture.height,\r\n                    this._rttRenderPassWrapper.renderPassDescriptor\r\n                );\r\n            }\r\n        }\r\n\r\n        this._currentRenderPass = this._rttRenderPassWrapper.renderPass;\r\n\r\n        this._debugFlushPendingCommands?.();\r\n\r\n        this._resetCurrentViewport(1);\r\n        this._resetCurrentScissor(1);\r\n        this._resetCurrentStencilRef(1);\r\n        this._resetCurrentColorBlend(1);\r\n\r\n        if (!gpuDepthStencilWrapper || !WebGPUTextureHelper.HasStencilAspect(gpuDepthStencilWrapper.format)) {\r\n            this._stencilStateComposer.enabled = false;\r\n        }\r\n    }\r\n\r\n    /** @hidden */\r\n    public _endRenderTargetRenderPass() {\r\n        if (this._currentRenderPass) {\r\n            const gpuWrapper = this._currentRenderTarget!.texture?._hardwareTexture as Nullable<WebGPUHardwareTexture>;\r\n            if (gpuWrapper && !this._snapshotRendering.endRenderTargetPass(this._currentRenderPass, gpuWrapper) && !this.compatibilityMode) {\r\n                this._bundleListRenderTarget.run(this._currentRenderPass);\r\n                this._bundleListRenderTarget.reset();\r\n            }\r\n            this._currentRenderPass.end();\r\n            if (this.dbgVerboseLogsForFirstFrames) {\r\n                if ((this as any)._count === undefined) {\r\n                    (this as any)._count = 0;\r\n                }\r\n                if (!(this as any)._count || (this as any)._count < this.dbgVerboseLogsNumFrames) {\r\n                    console.log(\"frame #\" + (this as any)._count + \" - render target end pass - internalTexture.uniqueId=\", this._currentRenderTarget?.texture?.uniqueId);\r\n                }\r\n            }\r\n            this._debugPopGroup?.(1);\r\n            this._resetCurrentViewport(1);\r\n            this._resetCurrentScissor(1);\r\n            this._resetCurrentStencilRef(1);\r\n            this._resetCurrentColorBlend(1);\r\n            this._currentRenderPass = null;\r\n            this._rttRenderPassWrapper.reset();\r\n        }\r\n    }\r\n\r\n    private _getCurrentRenderPass(): GPURenderPassEncoder {\r\n        if (this._currentRenderTarget && !this._currentRenderPass) {\r\n            // delayed creation of the render target pass, but we now need to create it as we are requested the render pass\r\n            this._startRenderTargetRenderPass(this._currentRenderTarget, false, null, false, false);\r\n        } else if (!this._currentRenderPass) {\r\n            this._startMainRenderPass(false);\r\n        }\r\n\r\n        return this._currentRenderPass!;\r\n    }\r\n\r\n    /** @hidden */\r\n    public _getCurrentRenderPassIndex(): number {\r\n        return this._currentRenderPass === null ? -1 : this._currentRenderPass === this._mainRenderPassWrapper.renderPass ? 0 : 1;\r\n    }\r\n\r\n    private _startMainRenderPass(setClearStates: boolean, clearColor?: Nullable<IColor4Like>, clearDepth?: boolean, clearStencil?: boolean): void {\r\n        if (this._mainRenderPassWrapper.renderPass) {\r\n            this._endMainRenderPass();\r\n        }\r\n\r\n        if (this.useReverseDepthBuffer) {\r\n            this.setDepthFunctionToGreaterOrEqual();\r\n        }\r\n\r\n        const mustClearColor = setClearStates && clearColor;\r\n        const mustClearDepth = setClearStates && clearDepth;\r\n        const mustClearStencil = setClearStates && clearStencil;\r\n\r\n        this._mainRenderPassWrapper.renderPassDescriptor!.colorAttachments[0]!.clearValue = mustClearColor ? clearColor : undefined;\r\n        this._mainRenderPassWrapper.renderPassDescriptor!.colorAttachments[0]!.loadOp = mustClearColor ? WebGPUConstants.LoadOp.Clear : WebGPUConstants.LoadOp.Load;\r\n        this._mainRenderPassWrapper.renderPassDescriptor!.depthStencilAttachment!.depthClearValue = mustClearDepth\r\n            ? this.useReverseDepthBuffer\r\n                ? this._clearReverseDepthValue\r\n                : this._clearDepthValue\r\n            : undefined;\r\n        this._mainRenderPassWrapper.renderPassDescriptor!.depthStencilAttachment!.depthLoadOp = mustClearDepth ? WebGPUConstants.LoadOp.Clear : WebGPUConstants.LoadOp.Load;\r\n        this._mainRenderPassWrapper.renderPassDescriptor!.depthStencilAttachment!.stencilClearValue = mustClearStencil ? this._clearStencilValue : undefined;\r\n        this._mainRenderPassWrapper.renderPassDescriptor!.depthStencilAttachment!.stencilLoadOp = !this.isStencilEnable\r\n            ? undefined\r\n            : mustClearStencil\r\n            ? WebGPUConstants.LoadOp.Clear\r\n            : WebGPUConstants.LoadOp.Load;\r\n        this._mainRenderPassWrapper.renderPassDescriptor!.occlusionQuerySet = this._occlusionQuery?.hasQueries ? this._occlusionQuery.querySet : undefined;\r\n\r\n        this._swapChainTexture = this._context.getCurrentTexture();\r\n        this._mainRenderPassWrapper.colorAttachmentGPUTextures[0]!.set(this._swapChainTexture);\r\n\r\n        // Resolve in case of MSAA\r\n        if (this._options.antialiasing) {\r\n            this._mainRenderPassWrapper.renderPassDescriptor!.colorAttachments[0]!.resolveTarget = this._swapChainTexture.createView();\r\n        } else {\r\n            this._mainRenderPassWrapper.renderPassDescriptor!.colorAttachments[0]!.view = this._swapChainTexture.createView();\r\n        }\r\n\r\n        if (this.dbgVerboseLogsForFirstFrames) {\r\n            if ((this as any)._count === undefined) {\r\n                (this as any)._count = 0;\r\n            }\r\n            if (!(this as any)._count || (this as any)._count < this.dbgVerboseLogsNumFrames) {\r\n                console.log(\r\n                    \"frame #\" + (this as any)._count + \" - main begin pass - texture width=\" + (this._mainTextureExtends as any).width,\r\n                    \" height=\" + (this._mainTextureExtends as any).height,\r\n                    this._mainRenderPassWrapper.renderPassDescriptor\r\n                );\r\n            }\r\n        }\r\n\r\n        this._debugPushGroup?.(\"main pass\", 0);\r\n\r\n        this._currentRenderPass = this._renderEncoder.beginRenderPass(this._mainRenderPassWrapper.renderPassDescriptor!);\r\n\r\n        this._mainRenderPassWrapper.renderPass = this._currentRenderPass;\r\n\r\n        this._debugFlushPendingCommands?.();\r\n\r\n        this._resetCurrentViewport(0);\r\n        this._resetCurrentScissor(0);\r\n        this._resetCurrentStencilRef(0);\r\n        this._resetCurrentColorBlend(0);\r\n\r\n        if (!this._isStencilEnable) {\r\n            this._stencilStateComposer.enabled = false;\r\n        }\r\n    }\r\n\r\n    private _endMainRenderPass(): void {\r\n        if (this._mainRenderPassWrapper.renderPass !== null) {\r\n            this._snapshotRendering.endMainRenderPass();\r\n            if (!this.compatibilityMode && !this._snapshotRendering.play) {\r\n                this._bundleList.run(this._mainRenderPassWrapper.renderPass);\r\n                this._bundleList.reset();\r\n            }\r\n            this._mainRenderPassWrapper.renderPass.end();\r\n            if (this.dbgVerboseLogsForFirstFrames) {\r\n                if ((this as any)._count === undefined) {\r\n                    (this as any)._count = 0;\r\n                }\r\n                if (!(this as any)._count || (this as any)._count < this.dbgVerboseLogsNumFrames) {\r\n                    console.log(\"frame #\" + (this as any)._count + \" - main end pass\");\r\n                }\r\n            }\r\n            this._debugPopGroup?.(0);\r\n            this._resetCurrentViewport(0);\r\n            this._resetCurrentScissor(0);\r\n            this._resetCurrentStencilRef(0);\r\n            this._resetCurrentColorBlend(0);\r\n            if (this._mainRenderPassWrapper.renderPass === this._currentRenderPass) {\r\n                this._currentRenderPass = null;\r\n            }\r\n            this._mainRenderPassWrapper.reset(false);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Binds the frame buffer to the specified texture.\r\n     * @param texture The render target wrapper to render to\r\n     * @param faceIndex The face of the texture to render to in case of cube texture\r\n     * @param requiredWidth The width of the target to render to\r\n     * @param requiredHeight The height of the target to render to\r\n     * @param forceFullscreenViewport Forces the viewport to be the entire texture/screen if true\r\n     * @param lodLevel defines the lod level to bind to the frame buffer\r\n     * @param layer defines the 2d array index to bind to frame buffer to\r\n     */\r\n    public bindFramebuffer(\r\n        texture: RenderTargetWrapper,\r\n        faceIndex: number = 0,\r\n        requiredWidth?: number,\r\n        requiredHeight?: number,\r\n        forceFullscreenViewport?: boolean,\r\n        lodLevel = 0,\r\n        layer = 0\r\n    ): void {\r\n        const hardwareTexture = texture.texture?._hardwareTexture as Nullable<WebGPUHardwareTexture>;\r\n\r\n        if (this._currentRenderTarget) {\r\n            this.unBindFramebuffer(this._currentRenderTarget);\r\n        }\r\n        this._currentRenderTarget = texture;\r\n        if (hardwareTexture) {\r\n            hardwareTexture._currentLayer = texture.isCube ? layer * 6 + faceIndex : layer;\r\n        }\r\n\r\n        this._rttRenderPassWrapper.colorAttachmentGPUTextures[0] = hardwareTexture;\r\n        this._rttRenderPassWrapper.depthTextureFormat = this._currentRenderTarget._depthStencilTexture\r\n            ? WebGPUTextureHelper.GetWebGPUTextureFormat(-1, this._currentRenderTarget._depthStencilTexture.format)\r\n            : undefined;\r\n\r\n        this._setDepthTextureFormat(this._rttRenderPassWrapper);\r\n        this._setColorFormat(this._rttRenderPassWrapper);\r\n\r\n        this._rttRenderPassWrapper.colorAttachmentViewDescriptor = {\r\n            format: this._colorFormat as GPUTextureFormat,\r\n            dimension: WebGPUConstants.TextureViewDimension.E2d,\r\n            mipLevelCount: 1,\r\n            baseArrayLayer: texture.isCube ? layer * 6 + faceIndex : layer,\r\n            baseMipLevel: lodLevel,\r\n            arrayLayerCount: 1,\r\n            aspect: WebGPUConstants.TextureAspect.All,\r\n        };\r\n\r\n        this._rttRenderPassWrapper.depthAttachmentViewDescriptor = {\r\n            format: this._depthTextureFormat!,\r\n            dimension: WebGPUConstants.TextureViewDimension.E2d,\r\n            mipLevelCount: 1,\r\n            baseArrayLayer: texture.isCube ? layer * 6 + faceIndex : layer,\r\n            baseMipLevel: 0,\r\n            arrayLayerCount: 1,\r\n            aspect: WebGPUConstants.TextureAspect.All,\r\n        };\r\n\r\n        if (this.dbgVerboseLogsForFirstFrames) {\r\n            if ((this as any)._count === undefined) {\r\n                (this as any)._count = 0;\r\n            }\r\n            if (!(this as any)._count || (this as any)._count < this.dbgVerboseLogsNumFrames) {\r\n                console.log(\r\n                    \"frame #\" + (this as any)._count + \" - bindFramebuffer called - internalTexture.uniqueId=\",\r\n                    texture.texture?.uniqueId,\r\n                    \"face=\",\r\n                    faceIndex,\r\n                    \"lodLevel=\",\r\n                    lodLevel,\r\n                    \"layer=\",\r\n                    layer,\r\n                    this._rttRenderPassWrapper.colorAttachmentViewDescriptor,\r\n                    this._rttRenderPassWrapper.depthAttachmentViewDescriptor\r\n                );\r\n            }\r\n        }\r\n\r\n        this._currentRenderPass = null; // lazy creation of the render pass, hoping the render pass will be created by a call to clear()...\r\n\r\n        if (this.snapshotRendering && this.snapshotRenderingMode === Constants.SNAPSHOTRENDERING_FAST) {\r\n            // force the creation of the render pass as we know in fast snapshot rendering mode clear() won't be called\r\n            this._getCurrentRenderPass();\r\n        }\r\n\r\n        if (this._cachedViewport && !forceFullscreenViewport) {\r\n            this.setViewport(this._cachedViewport, requiredWidth, requiredHeight);\r\n        } else {\r\n            if (!requiredWidth) {\r\n                requiredWidth = texture.width;\r\n                if (lodLevel) {\r\n                    requiredWidth = requiredWidth / Math.pow(2, lodLevel);\r\n                }\r\n            }\r\n            if (!requiredHeight) {\r\n                requiredHeight = texture.height;\r\n                if (lodLevel) {\r\n                    requiredHeight = requiredHeight / Math.pow(2, lodLevel);\r\n                }\r\n            }\r\n\r\n            this._viewport(0, 0, requiredWidth, requiredHeight);\r\n        }\r\n\r\n        this.wipeCaches();\r\n    }\r\n\r\n    /**\r\n     * Unbind the current render target texture from the WebGPU context\r\n     * @param texture defines the render target wrapper to unbind\r\n     * @param disableGenerateMipMaps defines a boolean indicating that mipmaps must not be generated\r\n     * @param onBeforeUnbind defines a function which will be called before the effective unbind\r\n     */\r\n    public unBindFramebuffer(texture: RenderTargetWrapper, disableGenerateMipMaps = false, onBeforeUnbind?: () => void): void {\r\n        const saveCRT = this._currentRenderTarget;\r\n\r\n        this._currentRenderTarget = null; // to be iso with thinEngine, this._currentRenderTarget must be null when onBeforeUnbind is called\r\n\r\n        if (onBeforeUnbind) {\r\n            onBeforeUnbind();\r\n        }\r\n\r\n        this._currentRenderTarget = saveCRT;\r\n\r\n        if (this._currentRenderPass && this._currentRenderPass !== this._mainRenderPassWrapper.renderPass) {\r\n            this._endRenderTargetRenderPass();\r\n        }\r\n\r\n        if (texture.texture?.generateMipMaps && !disableGenerateMipMaps && !texture.isCube) {\r\n            this._generateMipmaps(texture.texture);\r\n        }\r\n\r\n        this._currentRenderTarget = null;\r\n\r\n        this._onAfterUnbindFrameBufferObservable.notifyObservers(this);\r\n\r\n        if (this.dbgVerboseLogsForFirstFrames) {\r\n            if ((this as any)._count === undefined) {\r\n                (this as any)._count = 0;\r\n            }\r\n            if (!(this as any)._count || (this as any)._count < this.dbgVerboseLogsNumFrames) {\r\n                console.log(\"frame #\" + (this as any)._count + \" - unBindFramebuffer called - internalTexture.uniqueId=\", texture.texture?.uniqueId);\r\n            }\r\n        }\r\n\r\n        this._mrtAttachments = [];\r\n        this._cacheRenderPipeline.setMRT([]);\r\n        this._cacheRenderPipeline.setMRTAttachments(this._mrtAttachments);\r\n        this._currentRenderPass = this._mainRenderPassWrapper.renderPass;\r\n        this._setDepthTextureFormat(this._mainRenderPassWrapper);\r\n        this._setColorFormat(this._mainRenderPassWrapper);\r\n    }\r\n\r\n    /**\r\n     * Unbind the current render target and bind the default framebuffer\r\n     */\r\n    public restoreDefaultFramebuffer(): void {\r\n        if (this._currentRenderTarget) {\r\n            this.unBindFramebuffer(this._currentRenderTarget);\r\n        } else {\r\n            this._currentRenderPass = this._mainRenderPassWrapper.renderPass;\r\n            this._setDepthTextureFormat(this._mainRenderPassWrapper);\r\n            this._setColorFormat(this._mainRenderPassWrapper);\r\n        }\r\n        if (this._currentRenderPass) {\r\n            if (this._cachedViewport) {\r\n                this.setViewport(this._cachedViewport);\r\n            }\r\n        }\r\n\r\n        this.wipeCaches();\r\n    }\r\n\r\n    //------------------------------------------------------------------------------\r\n    //                              Render\r\n    //------------------------------------------------------------------------------\r\n\r\n    /**\r\n     * @param wrapper\r\n     * @hidden\r\n     */\r\n    public _setColorFormat(wrapper: WebGPURenderPassWrapper): void {\r\n        const format = wrapper.colorAttachmentGPUTextures[0]?.format ?? null;\r\n        this._cacheRenderPipeline.setColorFormat(format);\r\n        if (this._colorFormat === format) {\r\n            return;\r\n        }\r\n        this._colorFormat = format;\r\n    }\r\n\r\n    /**\r\n     * @param wrapper\r\n     * @hidden\r\n     */\r\n    public _setDepthTextureFormat(wrapper: WebGPURenderPassWrapper): void {\r\n        this._cacheRenderPipeline.setDepthStencilFormat(wrapper.depthTextureFormat);\r\n        if (this._depthTextureFormat === wrapper.depthTextureFormat) {\r\n            return;\r\n        }\r\n        this._depthTextureFormat = wrapper.depthTextureFormat;\r\n    }\r\n\r\n    public setDitheringState(): void {\r\n        // Does not exist in WebGPU\r\n    }\r\n\r\n    public setRasterizerState(): void {\r\n        // Does not exist in WebGPU\r\n    }\r\n\r\n    /**\r\n     * Set various states to the webGL context\r\n     * @param culling defines culling state: true to enable culling, false to disable it\r\n     * @param zOffset defines the value to apply to zOffset (0 by default)\r\n     * @param force defines if states must be applied even if cache is up to date\r\n     * @param reverseSide defines if culling must be reversed (CCW if false, CW if true)\r\n     * @param cullBackFaces true to cull back faces, false to cull front faces (if culling is enabled)\r\n     * @param stencil stencil states to set\r\n     * @param zOffsetUnits defines the value to apply to zOffsetUnits (0 by default)\r\n     */\r\n    public setState(culling: boolean, zOffset: number = 0, force?: boolean, reverseSide = false, cullBackFaces?: boolean, stencil?: IStencilState, zOffsetUnits: number = 0): void {\r\n        // Culling\r\n        if (this._depthCullingState.cull !== culling || force) {\r\n            this._depthCullingState.cull = culling;\r\n        }\r\n\r\n        // Cull face\r\n        const cullFace = this.cullBackFaces ?? cullBackFaces ?? true ? 1 : 2;\r\n        if (this._depthCullingState.cullFace !== cullFace || force) {\r\n            this._depthCullingState.cullFace = cullFace;\r\n        }\r\n\r\n        // Z offset\r\n        this.setZOffset(zOffset);\r\n        this.setZOffsetUnits(zOffsetUnits);\r\n\r\n        // Front face\r\n        const frontFace = reverseSide ? (this._currentRenderTarget ? 1 : 2) : this._currentRenderTarget ? 2 : 1;\r\n        if (this._depthCullingState.frontFace !== frontFace || force) {\r\n            this._depthCullingState.frontFace = frontFace;\r\n        }\r\n\r\n        this._stencilStateComposer.stencilMaterial = stencil;\r\n    }\r\n\r\n    private _applyRenderPassChanges(renderPass: GPURenderPassEncoder, bundleList: Nullable<WebGPUBundleList>): void {\r\n        const mustUpdateViewport = this._mustUpdateViewport(renderPass);\r\n        const mustUpdateScissor = this._mustUpdateScissor(renderPass);\r\n        const mustUpdateStencilRef = !this._stencilStateComposer.enabled ? false : this._mustUpdateStencilRef(renderPass);\r\n        const mustUpdateBlendColor = !this._alphaState.alphaBlend ? false : this._mustUpdateBlendColor(renderPass);\r\n\r\n        if (bundleList) {\r\n            if (mustUpdateViewport) {\r\n                bundleList.addItem(new WebGPURenderItemViewport(this._viewportCached.x, this._viewportCached.y, this._viewportCached.z, this._viewportCached.w));\r\n            }\r\n            if (mustUpdateScissor) {\r\n                bundleList.addItem(new WebGPURenderItemScissor(this._scissorCached.x, this._scissorCached.y, this._scissorCached.z, this._scissorCached.w));\r\n            }\r\n            if (mustUpdateStencilRef) {\r\n                bundleList.addItem(new WebGPURenderItemStencilRef(this._stencilStateComposer.funcRef ?? 0));\r\n            }\r\n            if (mustUpdateBlendColor) {\r\n                bundleList.addItem(new WebGPURenderItemBlendColor(this._alphaState._blendConstants.slice()));\r\n            }\r\n        } else {\r\n            if (mustUpdateViewport) {\r\n                this._applyViewport(renderPass as GPURenderPassEncoder);\r\n            }\r\n            if (mustUpdateScissor) {\r\n                this._applyScissor(renderPass as GPURenderPassEncoder);\r\n            }\r\n            if (mustUpdateStencilRef) {\r\n                this._applyStencilRef(renderPass as GPURenderPassEncoder);\r\n            }\r\n            if (mustUpdateBlendColor) {\r\n                this._applyBlendColor(renderPass as GPURenderPassEncoder);\r\n            }\r\n        }\r\n    }\r\n\r\n    private _draw(drawType: number, fillMode: number, start: number, count: number, instancesCount: number): void {\r\n        const renderPass = this._getCurrentRenderPass();\r\n        const renderPassIndex = this._getCurrentRenderPassIndex();\r\n        const bundleList = renderPassIndex === 0 ? this._bundleList : this._bundleListRenderTarget;\r\n\r\n        this.applyStates();\r\n\r\n        const webgpuPipelineContext = this._currentEffect!._pipelineContext as WebGPUPipelineContext;\r\n\r\n        this.bindUniformBufferBase(this._currentRenderTarget ? this._ubInvertY : this._ubDontInvertY, 0, WebGPUShaderProcessor.InternalsUBOName);\r\n\r\n        if (webgpuPipelineContext.uniformBuffer) {\r\n            webgpuPipelineContext.uniformBuffer.update();\r\n            this.bindUniformBufferBase(webgpuPipelineContext.uniformBuffer.getBuffer()!, 0, WebGPUShaderProcessor.LeftOvertUBOName);\r\n        }\r\n\r\n        if (this._snapshotRendering.play) {\r\n            this._reportDrawCall();\r\n            return;\r\n        }\r\n\r\n        if (\r\n            !this.compatibilityMode &&\r\n            (this._currentDrawContext.isDirty(this._currentMaterialContext.updateId) || this._currentMaterialContext.isDirty || this._currentMaterialContext.forceBindGroupCreation)\r\n        ) {\r\n            this._currentDrawContext.fastBundle = undefined;\r\n        }\r\n\r\n        const useFastPath = !this.compatibilityMode && this._currentDrawContext.fastBundle;\r\n        let renderPass2: GPURenderPassEncoder | GPURenderBundleEncoder = renderPass;\r\n\r\n        if (useFastPath || this._snapshotRendering.record) {\r\n            this._applyRenderPassChanges(renderPass, bundleList);\r\n            if (!this._snapshotRendering.record) {\r\n                this._counters.numBundleReuseNonCompatMode++;\r\n                if (this._currentDrawContext.indirectDrawBuffer) {\r\n                    this._currentDrawContext.setIndirectData(count, instancesCount || 1, start);\r\n                }\r\n                bundleList.addBundle(this._currentDrawContext.fastBundle);\r\n                this._reportDrawCall();\r\n                return;\r\n            }\r\n\r\n            renderPass2 = bundleList.getBundleEncoder(this._cacheRenderPipeline.colorFormats, this._depthTextureFormat, this.currentSampleCount); // for snapshot recording mode\r\n            bundleList.numDrawCalls++;\r\n        }\r\n\r\n        let textureState = 0;\r\n        if (!this._caps.textureFloatLinearFiltering && this._currentMaterialContext.hasFloatTextures) {\r\n            let bitVal = 1;\r\n            for (let i = 0; i < webgpuPipelineContext.shaderProcessingContext.textureNames.length; ++i) {\r\n                const textureName = webgpuPipelineContext.shaderProcessingContext.textureNames[i];\r\n                const texture = this._currentMaterialContext.textures[textureName]?.texture;\r\n                if (texture?.type === Constants.TEXTURETYPE_FLOAT) {\r\n                    textureState |= bitVal;\r\n                }\r\n                bitVal = bitVal << 1;\r\n            }\r\n        }\r\n\r\n        const pipeline = this._cacheRenderPipeline.getRenderPipeline(fillMode, this._currentEffect!, this.currentSampleCount, textureState);\r\n        const bindGroups = this._cacheBindGroups.getBindGroups(webgpuPipelineContext, this._currentDrawContext, this._currentMaterialContext);\r\n\r\n        if (!this._snapshotRendering.record) {\r\n            this._applyRenderPassChanges(renderPass, !this.compatibilityMode ? bundleList : null);\r\n            if (!this.compatibilityMode) {\r\n                this._counters.numBundleCreationNonCompatMode++;\r\n                renderPass2 = this._device.createRenderBundleEncoder({\r\n                    colorFormats: this._cacheRenderPipeline.colorFormats,\r\n                    depthStencilFormat: this._depthTextureFormat,\r\n                    sampleCount: this.currentSampleCount,\r\n                });\r\n            }\r\n        }\r\n\r\n        // bind pipeline\r\n        renderPass2.setPipeline(pipeline);\r\n\r\n        // bind index/vertex buffers\r\n        if (this._currentIndexBuffer) {\r\n            renderPass2.setIndexBuffer(\r\n                this._currentIndexBuffer.underlyingResource,\r\n                this._currentIndexBuffer!.is32Bits ? WebGPUConstants.IndexFormat.Uint32 : WebGPUConstants.IndexFormat.Uint16,\r\n                0\r\n            );\r\n        }\r\n\r\n        const vertexBuffers = this._cacheRenderPipeline.vertexBuffers;\r\n        for (let index = 0; index < vertexBuffers.length; index++) {\r\n            const vertexBuffer = vertexBuffers[index];\r\n\r\n            const buffer = vertexBuffer.getBuffer();\r\n            if (buffer) {\r\n                renderPass2.setVertexBuffer(index, buffer.underlyingResource, vertexBuffer._validOffsetRange ? 0 : vertexBuffer.byteOffset);\r\n            }\r\n        }\r\n\r\n        // bind bind groups\r\n        for (let i = 0; i < bindGroups.length; i++) {\r\n            renderPass2.setBindGroup(i, bindGroups[i]);\r\n        }\r\n\r\n        // draw\r\n        const nonCompatMode = !this.compatibilityMode && !this._snapshotRendering.record;\r\n\r\n        if (nonCompatMode && this._currentDrawContext.indirectDrawBuffer) {\r\n            this._currentDrawContext.setIndirectData(count, instancesCount || 1, start);\r\n            if (drawType === 0) {\r\n                renderPass2.drawIndexedIndirect(this._currentDrawContext.indirectDrawBuffer, 0);\r\n            } else {\r\n                renderPass2.drawIndirect(this._currentDrawContext.indirectDrawBuffer, 0);\r\n            }\r\n        } else if (drawType === 0) {\r\n            renderPass2.drawIndexed(count, instancesCount || 1, start, 0, 0);\r\n        } else {\r\n            renderPass2.draw(count, instancesCount || 1, start, 0);\r\n        }\r\n\r\n        if (nonCompatMode) {\r\n            this._currentDrawContext.fastBundle = (renderPass2 as GPURenderBundleEncoder).finish();\r\n            bundleList.addBundle(this._currentDrawContext.fastBundle);\r\n        }\r\n\r\n        this._reportDrawCall();\r\n    }\r\n\r\n    /**\r\n     * Draw a list of indexed primitives\r\n     * @param fillMode defines the primitive to use\r\n     * @param indexStart defines the starting index\r\n     * @param indexCount defines the number of index to draw\r\n     * @param instancesCount defines the number of instances to draw (if instantiation is enabled)\r\n     */\r\n    public drawElementsType(fillMode: number, indexStart: number, indexCount: number, instancesCount: number = 1): void {\r\n        this._draw(0, fillMode, indexStart, indexCount, instancesCount);\r\n    }\r\n\r\n    /**\r\n     * Draw a list of unindexed primitives\r\n     * @param fillMode defines the primitive to use\r\n     * @param verticesStart defines the index of first vertex to draw\r\n     * @param verticesCount defines the count of vertices to draw\r\n     * @param instancesCount defines the number of instances to draw (if instantiation is enabled)\r\n     */\r\n    public drawArraysType(fillMode: number, verticesStart: number, verticesCount: number, instancesCount: number = 1): void {\r\n        this._currentIndexBuffer = null;\r\n        this._draw(1, fillMode, verticesStart, verticesCount, instancesCount);\r\n    }\r\n\r\n    //------------------------------------------------------------------------------\r\n    //                              Dispose\r\n    //------------------------------------------------------------------------------\r\n\r\n    /**\r\n     * Dispose and release all associated resources\r\n     */\r\n    public dispose(): void {\r\n        this._mainTexture?.destroy();\r\n        this._mainTextureLastCopy?.destroy();\r\n        this._depthTexture?.destroy();\r\n        super.dispose();\r\n    }\r\n\r\n    //------------------------------------------------------------------------------\r\n    //                              Misc\r\n    //------------------------------------------------------------------------------\r\n\r\n    /**\r\n     * Gets the current render width\r\n     * @param useScreen defines if screen size must be used (or the current render target if any)\r\n     * @returns a number defining the current render width\r\n     */\r\n    public getRenderWidth(useScreen = false): number {\r\n        if (!useScreen && this._currentRenderTarget) {\r\n            return this._currentRenderTarget.width;\r\n        }\r\n\r\n        return this._canvas.width;\r\n    }\r\n\r\n    /**\r\n     * Gets the current render height\r\n     * @param useScreen defines if screen size must be used (or the current render target if any)\r\n     * @returns a number defining the current render height\r\n     */\r\n    public getRenderHeight(useScreen = false): number {\r\n        if (!useScreen && this._currentRenderTarget) {\r\n            return this._currentRenderTarget.height;\r\n        }\r\n\r\n        return this._canvas.height;\r\n    }\r\n\r\n    /**\r\n     * Gets the HTML canvas attached with the current WebGPU context\r\n     * @returns a HTML canvas\r\n     */\r\n    public getRenderingCanvas(): Nullable<HTMLCanvasElement> {\r\n        return this._canvas;\r\n    }\r\n\r\n    //------------------------------------------------------------------------------\r\n    //                              Errors\r\n    //------------------------------------------------------------------------------\r\n\r\n    /**\r\n     * Get the current error code of the WebGPU context\r\n     * @returns the error code\r\n     */\r\n    public getError(): number {\r\n        // TODO WEBGPU. from the webgpu errors.\r\n        return 0;\r\n    }\r\n\r\n    //------------------------------------------------------------------------------\r\n    //                              Unused WebGPU\r\n    //------------------------------------------------------------------------------\r\n\r\n    /**\r\n     * @hidden\r\n     */\r\n    public bindSamplers(): void {}\r\n\r\n    /**\r\n     * @hidden\r\n     */\r\n    public _bindTextureDirectly(): boolean {\r\n        return false;\r\n    }\r\n\r\n    /**\r\n     * Gets a boolean indicating if all created effects are ready\r\n     * @returns always true - No parallel shader compilation\r\n     */\r\n    public areAllEffectsReady(): boolean {\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * @param pipelineContext\r\n     * @param action\r\n     * @hidden\r\n     */\r\n    public _executeWhenRenderingStateIsCompiled(pipelineContext: IPipelineContext, action: () => void) {\r\n        // No parallel shader compilation.\r\n        // No Async, so direct launch\r\n        action();\r\n    }\r\n\r\n    /**\r\n     * @hidden\r\n     */\r\n    public _isRenderingStateCompiled(): boolean {\r\n        // No parallel shader compilation.\r\n        return true;\r\n    }\r\n\r\n    /** @hidden */\r\n    public _getUnpackAlignement(): number {\r\n        return 1;\r\n    }\r\n\r\n    /**\r\n     * @hidden\r\n     */\r\n    public _unpackFlipY() {}\r\n\r\n    /**\r\n     * @hidden\r\n     */\r\n    public _bindUnboundFramebuffer() {\r\n        throw \"_bindUnboundFramebuffer is not implementedin WebGPU! You probably want to use restoreDefaultFramebuffer or unBindFramebuffer instead\";\r\n    }\r\n\r\n    // TODO WEBGPU. All of the below should go once engine split with baseEngine.\r\n\r\n    /**\r\n     * @hidden\r\n     */\r\n    public _getSamplingParameters(): { min: number; mag: number } {\r\n        throw \"_getSamplingParameters is not available in WebGPU\";\r\n    }\r\n\r\n    /**\r\n     * @hidden\r\n     */\r\n    public getUniforms(): Nullable<WebGLUniformLocation>[] {\r\n        return [];\r\n    }\r\n\r\n    /**\r\n     * @hidden\r\n     */\r\n    public setIntArray(): boolean {\r\n        return false;\r\n    }\r\n\r\n    /**\r\n     * @hidden\r\n     */\r\n    public setIntArray2(): boolean {\r\n        return false;\r\n    }\r\n\r\n    /**\r\n     * @hidden\r\n     */\r\n    public setIntArray3(): boolean {\r\n        return false;\r\n    }\r\n\r\n    /**\r\n     * @hidden\r\n     */\r\n    public setIntArray4(): boolean {\r\n        return false;\r\n    }\r\n\r\n    /**\r\n     * @hidden\r\n     */\r\n    public setArray(): boolean {\r\n        return false;\r\n    }\r\n\r\n    /**\r\n     * @hidden\r\n     */\r\n    public setArray2(): boolean {\r\n        return false;\r\n    }\r\n\r\n    /**\r\n     * @hidden\r\n     */\r\n    public setArray3(): boolean {\r\n        return false;\r\n    }\r\n\r\n    /**\r\n     * @hidden\r\n     */\r\n    public setArray4(): boolean {\r\n        return false;\r\n    }\r\n\r\n    /**\r\n     * @hidden\r\n     */\r\n    public setMatrices(): boolean {\r\n        return false;\r\n    }\r\n\r\n    /**\r\n     * @hidden\r\n     */\r\n    public setMatrix3x3(): boolean {\r\n        return false;\r\n    }\r\n\r\n    /**\r\n     * @hidden\r\n     */\r\n    public setMatrix2x2(): boolean {\r\n        return false;\r\n    }\r\n\r\n    /**\r\n     * @hidden\r\n     */\r\n    public setFloat(): boolean {\r\n        return false;\r\n    }\r\n\r\n    /**\r\n     * @hidden\r\n     */\r\n    public setFloat2(): boolean {\r\n        return false;\r\n    }\r\n\r\n    /**\r\n     * @hidden\r\n     */\r\n    public setFloat3(): boolean {\r\n        return false;\r\n    }\r\n\r\n    /**\r\n     * @hidden\r\n     */\r\n    public setFloat4(): boolean {\r\n        return false;\r\n    }\r\n}\r\n"]}