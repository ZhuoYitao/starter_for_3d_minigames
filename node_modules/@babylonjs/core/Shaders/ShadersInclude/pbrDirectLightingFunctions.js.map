{"version":3,"file":"pbrDirectLightingFunctions.js","sourceRoot":"","sources":["../../../../../../lts/core/generated/Shaders/ShadersInclude/pbrDirectLightingFunctions.ts"],"names":[],"mappings":"AAAA,eAAe;AACf,OAAO,EAAE,WAAW,EAAE,MAAM,2BAA2B,CAAC;AAExD,IAAM,IAAI,GAAG,4BAA4B,CAAC;AAC1C,IAAM,MAAM,GAAG,0hLA+Hd,CAAC;AACF,aAAa;AACb,WAAW,CAAC,oBAAoB,CAAC,IAAI,CAAC,GAAG,MAAM,CAAC;AAChD,cAAc;AACd,MAAM,CAAC,IAAM,0BAA0B,GAAG,EAAE,IAAI,MAAA,EAAE,MAAM,QAAA,EAAE,CAAC","sourcesContent":["// Do not edit.\nimport { ShaderStore } from \"../../Engines/shaderStore\";\n\nconst name = \"pbrDirectLightingFunctions\";\nconst shader = `#define CLEARCOATREFLECTANCE90 1.0\nstruct lightingInfo\r{\rvec3 diffuse;\r#ifdef SPECULARTERM\nvec3 specular;\r#endif\n#ifdef CLEARCOAT\nvec4 clearCoat;\r#endif\n#ifdef SHEEN\nvec3 sheen;\r#endif\n};\rfloat adjustRoughnessFromLightProperties(float roughness,float lightRadius,float lightDistance) {\r#if defined(USEPHYSICALLIGHTFALLOFF) || defined(USEGLTFLIGHTFALLOFF)\nfloat lightRoughness=lightRadius/lightDistance;\rfloat totalRoughness=saturate(lightRoughness+roughness);\rreturn totalRoughness;\r#else\nreturn roughness;\r#endif\n}\rvec3 computeHemisphericDiffuseLighting(preLightingInfo info,vec3 lightColor,vec3 groundColor) {\rreturn mix(groundColor,lightColor,info.NdotL);\r}\rvec3 computeDiffuseLighting(preLightingInfo info,vec3 lightColor) {\rfloat diffuseTerm=diffuseBRDF_Burley(info.NdotL,info.NdotV,info.VdotH,info.roughness);\rreturn diffuseTerm*info.attenuation*info.NdotL*lightColor;\r}\r#define inline\nvec3 computeProjectionTextureDiffuseLighting(sampler2D projectionLightSampler,mat4 textureProjectionMatrix){\rvec4 strq=textureProjectionMatrix*vec4(vPositionW,1.0);\rstrq/=strq.w;\rvec3 textureColor=texture2D(projectionLightSampler,strq.xy).rgb;\rreturn toLinearSpace(textureColor);\r}\r#ifdef SS_TRANSLUCENCY\nvec3 computeDiffuseAndTransmittedLighting(preLightingInfo info,vec3 lightColor,vec3 transmittance) {\rfloat NdotL=absEps(info.NdotLUnclamped);\rfloat wrapNdotL=computeWrappedDiffuseNdotL(NdotL,0.02);\rfloat trAdapt=step(0.,info.NdotLUnclamped);\rvec3 transmittanceNdotL=mix(transmittance*wrapNdotL,vec3(wrapNdotL),trAdapt);\rfloat diffuseTerm=diffuseBRDF_Burley(NdotL,info.NdotV,info.VdotH,info.roughness);\rreturn diffuseTerm*transmittanceNdotL*info.attenuation*lightColor;\r}\r#endif\n#ifdef SPECULARTERM\nvec3 computeSpecularLighting(preLightingInfo info,vec3 N,vec3 reflectance0,vec3 reflectance90,float geometricRoughnessFactor,vec3 lightColor) {\rfloat NdotH=saturateEps(dot(N,info.H));\rfloat roughness=max(info.roughness,geometricRoughnessFactor);\rfloat alphaG=convertRoughnessToAverageSlope(roughness);\rvec3 fresnel=fresnelSchlickGGX(info.VdotH,reflectance0,reflectance90);\r#ifdef IRIDESCENCE\nfresnel=mix(fresnel,reflectance0,info.iridescenceIntensity);\r#endif\nfloat distribution=normalDistributionFunction_TrowbridgeReitzGGX(NdotH,alphaG);\r#ifdef BRDF_V_HEIGHT_CORRELATED\nfloat smithVisibility=smithVisibility_GGXCorrelated(info.NdotL,info.NdotV,alphaG);\r#else\nfloat smithVisibility=smithVisibility_TrowbridgeReitzGGXFast(info.NdotL,info.NdotV,alphaG);\r#endif\nvec3 specTerm=fresnel*distribution*smithVisibility;\rreturn specTerm*info.attenuation*info.NdotL*lightColor;\r}\r#endif\n#ifdef ANISOTROPIC\nvec3 computeAnisotropicSpecularLighting(preLightingInfo info,vec3 V,vec3 N,vec3 T,vec3 B,float anisotropy,vec3 reflectance0,vec3 reflectance90,float geometricRoughnessFactor,vec3 lightColor) {\rfloat NdotH=saturateEps(dot(N,info.H));\rfloat TdotH=dot(T,info.H);\rfloat BdotH=dot(B,info.H);\rfloat TdotV=dot(T,V);\rfloat BdotV=dot(B,V);\rfloat TdotL=dot(T,info.L);\rfloat BdotL=dot(B,info.L);\rfloat alphaG=convertRoughnessToAverageSlope(info.roughness);\rvec2 alphaTB=getAnisotropicRoughness(alphaG,anisotropy);\ralphaTB=max(alphaTB,square(geometricRoughnessFactor));\rvec3 fresnel=fresnelSchlickGGX(info.VdotH,reflectance0,reflectance90);\r#ifdef IRIDESCENCE\nfresnel=mix(fresnel,reflectance0,info.iridescenceIntensity);\r#endif\nfloat distribution=normalDistributionFunction_BurleyGGX_Anisotropic(NdotH,TdotH,BdotH,alphaTB);\rfloat smithVisibility=smithVisibility_GGXCorrelated_Anisotropic(info.NdotL,info.NdotV,TdotV,BdotV,TdotL,BdotL,alphaTB);\rvec3 specTerm=fresnel*distribution*smithVisibility;\rreturn specTerm*info.attenuation*info.NdotL*lightColor;\r}\r#endif\n#ifdef CLEARCOAT\nvec4 computeClearCoatLighting(preLightingInfo info,vec3 Ncc,float geometricRoughnessFactor,float clearCoatIntensity,vec3 lightColor) {\rfloat NccdotL=saturateEps(dot(Ncc,info.L));\rfloat NccdotH=saturateEps(dot(Ncc,info.H));\rfloat clearCoatRoughness=max(info.roughness,geometricRoughnessFactor);\rfloat alphaG=convertRoughnessToAverageSlope(clearCoatRoughness);\rfloat fresnel=fresnelSchlickGGX(info.VdotH,vClearCoatRefractionParams.x,CLEARCOATREFLECTANCE90);\rfresnel*=clearCoatIntensity;\rfloat distribution=normalDistributionFunction_TrowbridgeReitzGGX(NccdotH,alphaG);\rfloat kelemenVisibility=visibility_Kelemen(info.VdotH);\rfloat clearCoatTerm=fresnel*distribution*kelemenVisibility;\rreturn vec4(\rclearCoatTerm*info.attenuation*NccdotL*lightColor,\r1.0-fresnel\r);\r}\rvec3 computeClearCoatLightingAbsorption(float NdotVRefract,vec3 L,vec3 Ncc,vec3 clearCoatColor,float clearCoatThickness,float clearCoatIntensity) {\rvec3 LRefract=-refract(L,Ncc,vClearCoatRefractionParams.y);\rfloat NdotLRefract=saturateEps(dot(Ncc,LRefract));\rvec3 absorption=computeClearCoatAbsorption(NdotVRefract,NdotLRefract,clearCoatColor,clearCoatThickness,clearCoatIntensity);\rreturn absorption;\r}\r#endif\n#ifdef SHEEN\nvec3 computeSheenLighting(preLightingInfo info,vec3 N,vec3 reflectance0,vec3 reflectance90,float geometricRoughnessFactor,vec3 lightColor) {\rfloat NdotH=saturateEps(dot(N,info.H));\rfloat roughness=max(info.roughness,geometricRoughnessFactor);\rfloat alphaG=convertRoughnessToAverageSlope(roughness);\rfloat fresnel=1.;\rfloat distribution=normalDistributionFunction_CharlieSheen(NdotH,alphaG);\r/*#ifdef SHEEN_SOFTER\rfloat visibility=visibility_CharlieSheen(info.NdotL,info.NdotV,alphaG);\r#else */\nfloat visibility=visibility_Ashikhmin(info.NdotL,info.NdotV);\r/* #endif */\rfloat sheenTerm=fresnel*distribution*visibility;\rreturn sheenTerm*info.attenuation*info.NdotL*lightColor;\r}\r#endif\n`;\n// Sideeffect\nShaderStore.IncludesShadersStore[name] = shader;\n/** @hidden */\nexport const pbrDirectLightingFunctions = { name, shader };\n"]}